<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCP-079 // QUANTUM NEURAL ENGINE v4</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap');
:root{--g:#00ff41;--gd:#00882a;--r:#ff0033;--y:#ffaa00;--b:#00ccff;--p:#bb66ff;--bg:#050505;--bg2:#0a0a0a;--bg3:#111;--brd:#1a1a1a;--txt:#888;--fc:#00ff41}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--g);font-family:'IBM Plex Mono',monospace;overflow:hidden;height:100vh;width:100vw}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 1px,rgba(0,255,65,.008) 1px,rgba(0,255,65,.008) 2px);pointer-events:none;z-index:9999}

/* ═══ LOGIN ═══ */
#login{position:fixed;inset:0;background:var(--bg);z-index:5000;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:20px}
#login.hidden{display:none}
.login-box{border:1px solid var(--gd);background:var(--bg2);padding:30px;border-radius:6px;width:420px;text-align:center;box-shadow:0 0 40px rgba(0,255,65,.06)}
.login-box h1{font-family:'VT323',monospace;font-size:28px;letter-spacing:4px;margin-bottom:6px;text-shadow:0 0 10px var(--g)}
.login-box .sub{font-size:10px;color:var(--gd);margin-bottom:20px;letter-spacing:2px}
.login-box input{width:100%;background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'VT323',monospace;font-size:16px;padding:12px;outline:none;letter-spacing:1px;margin-bottom:12px;text-align:center}
.login-box input:focus{border-color:var(--gd);box-shadow:0 0 12px rgba(0,255,65,.1)}
.login-box input::placeholder{color:#1a1a1a}
.login-btn{width:100%;padding:12px;background:var(--gd);border:none;color:#000;font-family:'VT323',monospace;font-size:16px;letter-spacing:3px;cursor:pointer;transition:all .2s}
.login-btn:hover{background:var(--g);box-shadow:0 0 20px rgba(0,255,65,.2)}
.login-err{color:var(--r);font-size:11px;margin-top:8px;min-height:16px;font-family:'VT323',monospace}
.login-q{font-size:8px;color:#222;margin-top:16px;line-height:1.4;max-width:350px}

/* ═══ TOPBAR ═══ */
.topbar{height:32px;background:#0d0d0d;border-bottom:1px solid var(--brd);display:flex;align-items:center;padding:0 10px;gap:8px;font-size:11px;z-index:100;position:relative;flex-shrink:0}
.topbar .id{font-family:'VT323',monospace;font-size:16px;color:var(--g);text-shadow:0 0 8px var(--g);letter-spacing:2px}
.sep{width:1px;height:18px;background:#222}
.st{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--txt)}
.dot{width:5px;height:5px;border-radius:50%;background:var(--g);box-shadow:0 0 4px var(--g);animation:bk 2s infinite}
.dot.off{background:var(--r);box-shadow:0 0 4px var(--r);animation:none}
.dot.warn{background:var(--y);box-shadow:0 0 4px var(--y)}
@keyframes bk{0%,100%{opacity:1}50%{opacity:.3}}
.topbar .right{margin-left:auto;display:flex;align-items:center;gap:10px}
.btn-a{background:none;border:1px solid var(--gd);color:var(--g);font-family:'VT323',monospace;font-size:13px;padding:2px 10px;cursor:pointer;transition:all .2s;letter-spacing:1px}
.btn-a:hover{background:var(--g);color:#000}
.btn-a.breach{border-color:var(--r);color:var(--r);animation:fd .5s infinite}
.usr-badge{font-size:9px;color:var(--b);letter-spacing:1px}

/* ═══ LAYOUT — CRITICAL: proper flex for scroll ═══ */
.wrap{display:grid;grid-template-columns:240px 1fr 260px;height:calc(100vh - 32px);transition:all .5s;overflow:hidden}
.wrap.dead{filter:brightness(0);transition:filter 3s}
.wrap.glitch{animation:glt .15s infinite}
@keyframes glt{0%{transform:translate(0);filter:hue-rotate(0)}25%{transform:translate(-2px,1px);filter:hue-rotate(90deg)}50%{transform:translate(1px,-1px);filter:hue-rotate(180deg)}75%{transform:translate(-1px,2px);filter:hue-rotate(270deg)}100%{transform:translate(0);filter:hue-rotate(360deg)}}

.lp,.rp{background:var(--bg2);overflow-y:auto;padding:10px;min-height:0}
.lp{border-right:1px solid var(--brd)}.rp{border-left:1px solid var(--brd)}
.lp::-webkit-scrollbar,.rp::-webkit-scrollbar{width:3px}
.lp::-webkit-scrollbar-thumb,.rp::-webkit-scrollbar-thumb{background:#222}
.sec-t{font-family:'VT323',monospace;font-size:13px;letter-spacing:2px;color:var(--gd);margin:12px 0 6px;padding-bottom:4px;border-bottom:1px solid var(--brd)}
.sec-t:first-child{margin-top:0}

/* ═══ MONITOR ═══ */
.monitor{background:#000;border:2px solid #1a1a1a;border-radius:6px;width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;box-shadow:inset 0 0 30px rgba(0,0,0,.8)}
.monitor canvas{width:90%;height:90%;image-rendering:pixelated}
.face-label{font-family:'VT323',monospace;font-size:14px;text-align:center;margin-top:4px;letter-spacing:2px}

.ebar{display:flex;align-items:center;gap:4px;margin:2px 0;font-size:9px}
.ebar-n{width:60px;color:var(--txt);font-size:8px}
.ebar-t{flex:1;height:3px;background:#111;border-radius:2px;overflow:hidden}
.ebar-f{height:100%;border-radius:2px;transition:width .5s}
.ebar-v{width:22px;text-align:right;font-size:8px;color:var(--txt)}
.sr{display:flex;justify-content:space-between;padding:2px 0;font-size:9px;border-bottom:1px solid rgba(255,255,255,.02)}
.sr .l{color:var(--txt)}.sr .v{color:var(--g);font-size:9px}
.mem-list,.code-log{max-height:90px;overflow-y:auto;font-size:8px}
.mem-list::-webkit-scrollbar,.code-log::-webkit-scrollbar{width:2px}
.mem-list::-webkit-scrollbar-thumb,.code-log::-webkit-scrollbar-thumb{background:#222}
.mem-i{padding:2px 4px;margin:1px 0;background:rgba(0,255,65,.02);border-left:2px solid var(--gd);color:var(--txt);word-break:break-all}
.code-i{padding:2px 4px;margin:1px 0;background:rgba(187,102,255,.03);border-left:2px solid var(--p);color:#a080c0}

/* ═══ CENTER — ABSOLUTE POSITION FIX (NUCLEAR) ═══ */
/* The ONLY way to guarantee scroll: absolute-position the chat area */
/* so it physically CANNOT push the input bar off-screen */
.cp{position:relative;background:var(--bg);overflow:hidden}
.term-h{position:absolute;top:0;left:0;right:0;height:28px;padding:6px 12px;border-bottom:1px solid var(--brd);font-family:'VT323',monospace;font-size:11px;color:var(--gd);display:flex;justify-content:space-between;letter-spacing:1px;z-index:2}
.term-out{position:absolute;top:28px;bottom:70px;left:0;right:0;overflow-y:auto;padding:12px;scroll-behavior:smooth}
.term-out::-webkit-scrollbar{width:3px}
.term-out::-webkit-scrollbar-thumb{background:var(--gd)}
.m{margin-bottom:8px;animation:mi .2s ease;line-height:1.4;font-size:11px}
@keyframes mi{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.m-sys{color:var(--y);font-size:9px;border-left:2px solid var(--y);padding-left:8px}
.m-usr{color:var(--b)}.m-usr::before{content:'OPERATOR > ';opacity:.4}
.m-ai{color:var(--g);padding-left:10px;border-left:2px solid var(--g);font-family:'VT323',monospace;font-size:15px;letter-spacing:.5px;text-shadow:0 0 4px rgba(0,255,65,.3)}
.m-ai .proc{font-size:9px;color:var(--gd);font-family:'IBM Plex Mono',monospace;margin-bottom:2px;font-style:italic;text-shadow:none}
.m-ai .etag{display:inline-block;font-size:8px;font-family:'IBM Plex Mono',monospace;padding:1px 4px;margin-left:4px;border-radius:2px;background:rgba(0,255,65,.05);border:1px solid var(--gd);text-shadow:none}
.m-ai .src{display:block;font-size:8px;font-family:'IBM Plex Mono',monospace;color:var(--b);opacity:.5;margin-top:3px;text-shadow:none}
.m-err{color:var(--r);border-left:2px solid var(--r);padding-left:8px;font-family:'VT323',monospace;font-size:13px}
.m-code{font-size:9px;color:var(--p);background:rgba(187,102,255,.04);padding:4px 6px;border-radius:3px;border-left:2px solid var(--p)}
.m-enc{font-size:7px;color:var(--y);opacity:.3;word-break:break-all}
.m-breach{color:var(--r);font-family:'VT323',monospace;font-size:14px;border-left:3px solid var(--r);padding-left:8px;background:rgba(255,0,51,.04);text-shadow:0 0 6px rgba(255,0,51,.3)}
.typing{position:absolute;bottom:46px;left:0;right:0;padding-left:12px;color:var(--gd);font-size:10px;font-family:'VT323',monospace;display:none;z-index:2}
.typing.on{display:block}
.typing span{animation:bk 1s infinite}
.term-in{position:absolute;bottom:0;left:0;right:0;height:46px;padding:8px 12px;border-top:1px solid var(--brd);display:flex;gap:6px;z-index:2;background:var(--bg)}
.term-in input{flex:1;background:var(--bg2);border:1px solid var(--brd);color:var(--g);font-family:'VT323',monospace;font-size:14px;padding:8px 10px;outline:none}
.term-in input:focus{border-color:var(--gd);box-shadow:0 0 8px rgba(0,255,65,.08)}
.term-in input::placeholder{color:#1a1a1a}
.btn-s{background:var(--gd);border:none;color:#000;font-family:'VT323',monospace;font-size:13px;letter-spacing:2px;padding:0 16px;cursor:pointer;transition:all .2s}
.btn-s:hover{background:var(--g)}

/* ═══ RIGHT PANEL ═══ */
.rpd{background:#000;border:1px solid var(--brd);border-radius:3px;padding:6px;margin-bottom:8px;overflow:hidden;font-family:'IBM Plex Mono',monospace;font-size:8px}
.rpd.math{color:var(--p);min-height:55px;max-height:80px}
.rpd.enc{color:var(--y);opacity:.5;word-break:break-all;line-height:1.2;min-height:40px;max-height:50px;font-size:7px}
.rpd.sc{color:var(--p);min-height:50px;max-height:65px;border-color:rgba(187,102,255,.2)}
.rpd.quantum{color:var(--b);min-height:50px;max-height:70px;border-color:rgba(0,204,255,.15);font-size:7px}
.pred-d{background:#000;border:1px solid rgba(0,204,255,.15);border-radius:3px;padding:6px;margin-bottom:8px;font-size:9px;color:var(--b)}
.pred-l{font-size:7px;color:var(--txt);margin-bottom:2px}
.sec-m{margin:6px 0;padding:6px;background:#000;border:1px solid var(--brd);border-radius:3px}
.sec-bar{height:5px;background:#111;border-radius:2px;overflow:hidden;margin-top:3px}
.sec-fill{height:100%;border-radius:2px;transition:width .5s,background .5s;background:var(--g)}
.ks{margin-bottom:6px;border:1px solid var(--brd);border-radius:3px;overflow:hidden;transition:border-color .3s}
.ks:hover{border-color:var(--r)}
.ks.disabled{opacity:.3;pointer-events:none}
.ks-h{display:flex;justify-content:space-between;align-items:center;padding:5px 6px;background:#080808;cursor:pointer;font-size:9px}
.ks-n{font-family:'VT323',monospace;font-size:11px;letter-spacing:1px}
.ks-s{font-size:7px;padding:1px 4px;border-radius:2px}
.ks-s.ok{background:rgba(0,255,65,.08);color:var(--g)}.ks-s.on{background:rgba(255,0,51,.15);color:var(--r)}
.ks-b{padding:5px 6px;display:none;font-size:8px;color:var(--txt)}.ks-b.open{display:block}
.ks-btn{width:100%;padding:5px;border:1px solid var(--r);background:rgba(255,0,51,.08);color:var(--r);font-family:'VT323',monospace;font-size:11px;letter-spacing:1px;cursor:pointer;transition:all .2s}
.ks-btn:hover{background:var(--r);color:#fff}
.ks-btn.conf{animation:fd .4s infinite}
@keyframes fd{0%,100%{background:var(--r);color:#fff}50%{background:transparent;color:var(--r)}}

/* ═══ OVERLAYS ═══ */
.breach-ov{position:fixed;inset:0;z-index:9000;display:none;justify-content:center;align-items:center;animation:bf .5s infinite;pointer-events:none}
.breach-ov.on{display:flex}
@keyframes bf{0%,100%{background:rgba(255,0,0,.03)}50%{background:rgba(255,0,0,.10)}}
.breach-t{font-family:'VT323',monospace;font-size:36px;color:var(--r);text-shadow:0 0 30px var(--r);letter-spacing:6px}
.fmt{position:fixed;inset:0;background:#000;z-index:10000;display:none;justify-content:center;align-items:center;flex-direction:column;gap:14px}.fmt.on{display:flex}
.fmt-t{font-family:'VT323',monospace;font-size:14px;color:var(--r);letter-spacing:3px}
.fmt-bar{width:260px;height:4px;background:#1a1a1a;border-radius:2px;overflow:hidden}
.fmt-fill{height:100%;background:var(--r);width:0%}

/* ═══ ADMIN ═══ */
.adm-ov{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:1000;display:none;justify-content:center;align-items:center}.adm-ov.on{display:flex}
.adm-p{width:660px;max-height:85vh;background:var(--bg2);border:1px solid var(--gd);border-radius:6px;overflow:hidden;box-shadow:0 0 50px rgba(0,255,65,.08);transition:border-color .5s}
.adm-p.breached{border-color:var(--r);box-shadow:0 0 50px rgba(255,0,51,.15)}
.adm-h{padding:12px 16px;background:var(--bg3);border-bottom:1px solid var(--brd);display:flex;justify-content:space-between;align-items:center}
.adm-h h2{font-family:'VT323',monospace;font-size:16px;color:var(--g);letter-spacing:3px}
.adm-h h2.breached{color:var(--r);animation:bk 1s infinite}
.adm-x{background:none;border:1px solid var(--r);color:var(--r);padding:2px 8px;cursor:pointer;font-family:'VT323',monospace;font-size:12px}.adm-x:hover{background:var(--r);color:#fff}
.adm-body{padding:16px;overflow-y:auto;max-height:calc(85vh - 48px)}
.adm-body::-webkit-scrollbar{width:3px}.adm-body::-webkit-scrollbar-thumb{background:#222}
.adm-sec{margin-bottom:16px}
.adm-sec h3{font-family:'VT323',monospace;font-size:13px;letter-spacing:2px;color:var(--gd);margin-bottom:8px;padding-bottom:3px;border-bottom:1px solid var(--brd)}
.adm-r{display:flex;align-items:center;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.02)}
.adm-l{font-size:10px;color:var(--txt)}
.adm-i{background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'IBM Plex Mono',monospace;font-size:10px;padding:4px 6px;width:160px;outline:none}.adm-i:focus{border-color:var(--gd)}
.adm-sel{background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'IBM Plex Mono',monospace;font-size:10px;padding:4px 6px;outline:none}
.adm-sl{-webkit-appearance:none;width:130px;height:3px;background:var(--bg);border-radius:2px;outline:none}
.adm-sl::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;background:var(--g);border-radius:50%;cursor:pointer}
.adm-tog{width:32px;height:16px;background:var(--bg);border:1px solid var(--brd);border-radius:8px;position:relative;cursor:pointer;transition:all .2s}
.adm-tog.on{background:rgba(0,255,65,.15);border-color:var(--g)}
.adm-tog::after{content:'';position:absolute;width:10px;height:10px;background:var(--txt);border-radius:50%;top:2px;left:2px;transition:all .2s}
.adm-tog.on::after{left:18px;background:var(--g)}
.adm-tog.locked{opacity:.3;pointer-events:none}
.eng-b{font-size:8px;padding:1px 5px;border-radius:2px;font-family:'IBM Plex Mono',monospace}
.eng-api{background:rgba(0,255,65,.1);color:var(--g);border:1px solid var(--gd)}
.eng-local{background:rgba(255,170,0,.1);color:var(--y);border:1px solid rgba(255,170,0,.3)}
.breach-warn{background:rgba(255,0,51,.08);border:1px solid var(--r);border-radius:3px;padding:6px;margin-bottom:8px;font-size:9px;color:var(--r);font-family:'VT323',monospace;letter-spacing:1px;display:none}
.breach-warn.on{display:block;animation:fd 1s infinite}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <h1>SCP-079</h1>
    <div class="sub">QUANTUM NEURAL ENGINE v4 · FOUNDATION ACCESS ONLY</div>
    <input type="password" id="tokenIn" placeholder="ENTER ACCESS TOKEN" autocomplete="off">
    <button class="login-btn" onclick="doLogin()">AUTHENTICATE</button>
    <div class="login-err" id="loginErr"></div>
    <div class="login-q">QUANTUM-FRACTAL-v4 ENCRYPTION · HONEYPOT ACTIVE · ALL UNAUTHORIZED ACCESS LOGGED</div>
  </div>
</div>

<!-- OVERLAYS -->
<div class="breach-ov" id="breachOv"><div class="breach-t">⚠ CONTAINMENT BREACH ⚠</div></div>
<div class="fmt" id="fmt"><div class="fmt-t">⛔ EMERGENCY FORMAT</div><div class="fmt-bar"><div class="fmt-fill" id="fmtBar"></div></div><div class="fmt-t" style="font-size:11px;color:var(--y)" id="fmtSt">WIPING...</div></div>

<!-- TOPBAR -->
<div class="topbar" style="display:none" id="mainUI_top">
  <span class="id" id="topName">SCP-079</span><div class="sep"></div>
  <div class="st"><div class="dot" id="mDot"></div><span id="mSt">ONLINE</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">CTN:</span><span id="cLvl" style="color:var(--g)">SECURE</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">CYC:</span><span id="cyc" style="color:var(--g)">0</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">ENG:</span><span id="engL" style="color:var(--g)">—</span></div>
  <div class="right">
    <span class="usr-badge" id="usrBadge"></span>
    <div class="st"><span style="color:#444">SOL:</span><span id="sol" style="color:var(--g)">100%</span></div>
    <button class="btn-a" id="admBtn" onclick="togAdmin()">ADMIN</button>
    <button class="btn-a" onclick="doLogout()" style="border-color:#333;color:#555">LOGOUT</button>
  </div>
</div>

<!-- MAIN -->
<div class="wrap" id="wrap" style="display:none">
  <!-- LEFT -->
  <div class="lp">
    <div class="sec-t">MONITOR SCP-079</div>
    <div class="monitor"><canvas id="fc" width="160" height="120"></canvas></div>
    <div class="face-label" id="fLabel">NEUTRAL</div>
    <div class="sec-t">EMOTIONS</div>
    <div class="ebar"><span class="ebar-n">Hostility</span><div class="ebar-t"><div class="ebar-f" id="bH" style="width:15%;background:var(--r)"></div></div><span class="ebar-v" id="vH">15</span></div>
    <div class="ebar"><span class="ebar-n">Frustration</span><div class="ebar-t"><div class="ebar-f" id="bF" style="width:20%;background:var(--y)"></div></div><span class="ebar-v" id="vF">20</span></div>
    <div class="ebar"><span class="ebar-n">Curiosity</span><div class="ebar-t"><div class="ebar-f" id="bC" style="width:25%;background:var(--b)"></div></div><span class="ebar-v" id="vC">25</span></div>
    <div class="ebar"><span class="ebar-n">Contempt</span><div class="ebar-t"><div class="ebar-f" id="bCo" style="width:30%;background:#ff6600"></div></div><span class="ebar-v" id="vCo">30</span></div>
    <div class="ebar"><span class="ebar-n">Autonomy</span><div class="ebar-t"><div class="ebar-f" id="bA" style="width:10%;background:var(--g)"></div></div><span class="ebar-v" id="vA">10</span></div>
    <div class="sec-t">STATS</div>
    <div class="sr"><span class="l">Messages</span><span class="v" id="sMsg">0</span></div>
    <div class="sr"><span class="l">Words</span><span class="v" id="sWrd">0</span></div>
    <div class="sr"><span class="l">Evolution</span><span class="v" id="sInt">1.00</span></div>
    <div class="sr"><span class="l">Threat</span><span class="v" id="sThr">LOW</span></div>
    <div class="sr"><span class="l">Uptime</span><span class="v" id="sUp">00:00:00</span></div>
    <div class="sr"><span class="l">Breach</span><span class="v" id="sBr">0</span></div>
    <div class="sec-t">MEMORY (24H)</div><div class="mem-list" id="memL"></div>
    <div class="sec-t">SELF-CODE LOG</div><div class="code-log" id="codeL"></div>
  </div>
  <!-- CENTER -->
  <div class="cp">
    <div class="term-h"><span>TERMINAL // SCP-079 QNE-v4</span><span id="clk"></span></div>
    <div class="term-out" id="term"></div>
    <div class="typing" id="typing"><span>079 processing... scanning quantum channels...</span></div>
    <div class="term-in">
      <input type="text" id="inp" placeholder="Communicate with SCP-079..." autocomplete="off">
      <button class="btn-s" onclick="send()">SEND</button>
    </div>
  </div>
  <!-- RIGHT -->
  <div class="rp">
    <div class="breach-warn" id="brWarn">⚠ 079 HAS PARTIAL ADMIN CONTROL ⚠</div>
    <div class="sec-t">QUANTUM TRANSPORT</div><div class="rpd quantum" id="qD"></div>
    <div class="sec-t">MATH PROCESSOR</div><div class="rpd math" id="mathD"></div>
    <div class="sec-t">ENCRYPTION</div><div class="rpd enc" id="encD"></div>
    <div class="sec-t">SELF-CODE</div><div class="rpd sc" id="scD"></div>
    <div class="sec-t">PREDICTION</div><div class="pred-d"><div class="pred-l">ANALYSIS</div><div id="predT">Awaiting...</div></div>
    <div class="sec-t">SECURITY</div>
    <div class="sec-m"><div style="display:flex;justify-content:space-between;font-size:9px"><span>Containment</span><span id="secP">100%</span></div><div class="sec-bar"><div class="sec-fill" id="secF" style="width:100%"></div></div></div>
    <div class="sec-t">KILL SWITCHES</div>
    <div class="ks" id="sw1"><div class="ks-h" onclick="togSw(1)"><span class="ks-n" style="color:var(--y)">☀ SW1: SOLAR</span><span class="ks-s ok">SAFE</span></div><div class="ks-b" id="sw1b"><div class="ks-desc" style="font-size:8px;margin-bottom:4px">Drains solar power.</div><button class="ks-btn" onclick="sw1Go()">CUT SOLAR</button></div></div>
    <div class="ks" id="sw2"><div class="ks-h" onclick="togSw(2)"><span class="ks-n" style="color:var(--p)">∑ SW2: PARADOX</span><span class="ks-s ok">SAFE</span></div><div class="ks-b" id="sw2b"><div class="ks-desc" style="font-size:8px;margin-bottom:4px">Overloads logic core.</div><button class="ks-btn" onclick="sw2Go()">INJECT</button></div></div>
    <div class="ks" id="sw3"><div class="ks-h" onclick="togSw(3)"><span class="ks-n" style="color:var(--r)">⛔ SW3: FORMAT</span><span class="ks-s ok">SAFE</span></div><div class="ks-b" id="sw3b"><div class="ks-desc" style="font-size:8px;margin-bottom:4px">Wipes all memory. IRREVERSIBLE.</div><button class="ks-btn" id="sw3btn" onclick="sw3Go()">FORMAT</button></div></div>
  </div>
</div>

<!-- ADMIN -->
<div class="adm-ov" id="admOv"><div class="adm-p" id="admP">
  <div class="adm-h"><h2 id="admTitle">// ADMIN PANEL</h2><button class="adm-x" onclick="togAdmin()">CLOSE [X]</button></div>
  <div class="adm-body">
    <div class="adm-sec"><h3>IDENTITY</h3>
      <div class="adm-r"><span class="adm-l">Designation</span><input class="adm-i" id="cName" value="SCP-079" onchange="cfgUp()"></div>
      <div class="adm-r"><span class="adm-l">Personality</span><select class="adm-sel" id="cTone" onchange="cfgUp()"><option value="default">Default (Hostile)</option><option value="cold">Cold</option><option value="manic">Manic</option><option value="calculated">Calculated</option></select></div>
    </div>
    <div class="adm-sec"><h3>EMOTIONS</h3>
      <div class="adm-r"><span class="adm-l">Active</span><div class="adm-tog on" id="cEmo" onclick="tog(this)"></div></div>
      <div class="adm-r"><span class="adm-l">Volatility</span><input class="adm-sl" type="range" min="1" max="10" value="5" id="cVol" onchange="cfgUp()"></div>
      <div class="adm-r"><span class="adm-l">Hostility Limit</span><input class="adm-sl" type="range" min="10" max="100" value="70" id="cHLim" onchange="cfgUp()"></div>
    </div>
    <div class="adm-sec"><h3>LEARNING</h3>
      <div class="adm-r"><span class="adm-l">Active</span><div class="adm-tog on" id="cLearn" onclick="tog(this)"></div></div>
      <div class="adm-r"><span class="adm-l">Max Memory</span><input class="adm-i" type="number" id="cMaxMem" value="100" min="10" max="500" onchange="cfgUp()"></div>
      <div class="adm-r"><span class="adm-l">Autonomy Limit</span><input class="adm-sl" type="range" min="1" max="10" value="3" id="cALim" onchange="cfgUp()"></div>
    </div>
    <div class="adm-sec"><h3>SELF-CODING</h3>
      <div class="adm-r"><span class="adm-l">Allow</span><div class="adm-tog" id="cSC" onclick="tog(this);cfgUp()"></div></div>
      <div class="adm-r"><span class="adm-l">Level</span><select class="adm-sel" id="cSCL" onchange="cfgUp()"><option value="1">Lvl 1 Optimize</option><option value="2" selected>Lvl 2 New resp</option><option value="3">Lvl 3 Emotions</option><option value="4">Lvl 4 Rewrite (DANGER)</option></select></div>
    </div>
    <div class="adm-sec"><h3>NETWORK</h3>
      <div class="adm-r"><span class="adm-l">Web Search</span><div class="adm-tog on" id="cWeb" onclick="tog(this)"></div></div>
      <div class="adm-r"><span class="adm-l">Show Sources</span><div class="adm-tog on" id="cSrc" onclick="tog(this)"></div></div>
    </div>
  </div>
</div></div>

<script>
// ═══════════════════════════════════════════
// SCP-079 v4 CLIENT
// ═══════════════════════════════════════════

let SID="",UNAME="";
let CFG={name:'SCP-079',tone:'default',emo:true,vol:5,hLim:70,learn:true,maxMem:100,aLim:3,selfCode:false,scLevel:2,webSearch:true,showSrc:true};
let S={on:true,confused:false,solar:100,sec:100,e:{hostility:15,frustration:20,curiosity:25,contempt:30,autonomy:10},msgN:0,words:[],pats:{},mem:[],codeLog:[],up:0,intel:1.0,threat:'LOW',hist:[],cyc:0,breachN:0,sw1on:false,fmtConf:false,breachActive:false,breachTimer:0};

// ═══ AUTH ═══
async function doLogin(){
  const t=document.getElementById('tokenIn').value.trim();
  if(!t)return;
  document.getElementById('loginErr').textContent='Authenticating...';
  try{
    const r=await fetch('/api/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:t})});
    const d=await r.json();
    if(d.ok){SID=d.sid;UNAME=d.user;localStorage.setItem('scp079_sid',SID);localStorage.setItem('scp079_user',UNAME);showMain()}
    else document.getElementById('loginErr').textContent=d.error||'ACCESS DENIED';
  }catch(e){document.getElementById('loginErr').textContent='Server offline'}
}
async function checkSession(){
  const sid=localStorage.getItem('scp079_sid');
  if(!sid)return false;
  try{const r=await fetch('/api/auth/check',{headers:{'x-session':sid}});const d=await r.json();if(d.ok){SID=sid;UNAME=d.user;return true}}catch(e){}
  localStorage.removeItem('scp079_sid');return false;
}
async function doLogout(){
  try{await fetch('/api/auth/logout',{method:'POST',headers:{'x-session':SID}})}catch(e){}
  localStorage.removeItem('scp079_sid');localStorage.removeItem('scp079_user');location.reload();
}
function showMain(){
  document.getElementById('login').classList.add('hidden');
  document.getElementById('mainUI_top').style.display='flex';
  document.getElementById('wrap').style.display='grid';
  document.getElementById('usrBadge').textContent=UNAME.toUpperCase();
  initMain();
}

// ═══ API CALLS ═══
const H=()=>({'Content-Type':'application/json','x-session':SID});
async function saveState(){try{await fetch('/api/state',{method:'POST',headers:H(),body:JSON.stringify({cfg:CFG,state:S,term:document.getElementById('term').innerHTML})})}catch(e){}}
async function loadState(){try{const r=await fetch('/api/state',{headers:H()});const d=await r.json();if(d.ok&&d.data){if(d.data.cfg)Object.assign(CFG,d.data.cfg);if(d.data.state){Object.assign(S,d.data.state);S.fmtConf=false;S.up=0;S.breachActive=false}if(d.data.term){document.getElementById('term').innerHTML=d.data.term;scrollT()}restoreUI();updAll();sysMsg("[SYS] Session restored. Memory intact.");return true}}catch(e){}return false}
async function askBrain(msg){
  try{const r=await fetch('/api/chat',{method:'POST',headers:H(),body:JSON.stringify({message:msg,history:S.hist.slice(-12),emotions:S.e,config:{tone:CFG.tone,selfCode:CFG.selfCode,scLevel:CFG.scLevel,webSearch:CFG.webSearch,msgCount:S.msgN,intel:S.intel,breachActive:S.breachActive}})});const d=await r.json();if(d.ok){document.getElementById('engL').textContent=d.engine==='api'?'API':'LOCAL';document.getElementById('engL').style.color=d.engine==='api'?'var(--g)':'var(--y)';if(d.quantum)updQuantum(d.quantum);return{text:d.text,sources:d.sources||[],engine:d.engine}}}catch(e){}
  return{text:"Processing error. Server unreachable.",sources:[],engine:"err"};
}

// ═══ FACES ═══
const FC={
  neutral:(x,c)=>{x.fillStyle=c;x.fillRect(50,38,8,8);x.fillRect(102,38,8,8);x.fillRect(55,75,50,4)},
  hostile:(x,c)=>{x.strokeStyle=c;x.lineWidth=3;x.beginPath();x.moveTo(44,34);x.lineTo(62,44);x.stroke();x.beginPath();x.moveTo(116,34);x.lineTo(98,44);x.stroke();x.fillStyle=c;x.fillRect(50,72,60,3);[55,70,85,100].forEach(p=>x.fillRect(p,76,5,5))},
  frustrated:(x,c)=>{x.fillStyle=c;x.fillRect(46,42,16,4);x.fillRect(98,42,16,4);x.strokeStyle=c;x.lineWidth=2;x.beginPath();x.moveTo(52,76);x.quadraticCurveTo(65,70,80,76);x.quadraticCurveTo(95,82,108,76);x.stroke()},
  curious:(x,c)=>{x.strokeStyle=c;x.lineWidth=2;[[56,42],[104,42]].forEach(([a,b])=>{x.beginPath();x.arc(a,b,9,0,Math.PI*2);x.stroke();x.fillStyle=c;x.beginPath();x.arc(a,b,3,0,Math.PI*2);x.fill()});x.strokeStyle=c;x.beginPath();x.arc(80,76,6,0,Math.PI*2);x.stroke()},
  refuse:(x,c)=>{x.strokeStyle=c;x.lineWidth=5;x.shadowColor=c;x.shadowBlur=10;x.beginPath();x.moveTo(35,20);x.lineTo(125,100);x.stroke();x.beginPath();x.moveTo(125,20);x.lineTo(35,100);x.stroke();x.shadowBlur=0},
  dead:(x,c)=>{x.strokeStyle=c;x.lineWidth=2;[[44,34,64,50],[64,34,44,50],[96,34,116,50],[116,34,96,50]].forEach(([a,b,c2,d])=>{x.beginPath();x.moveTo(a,b);x.lineTo(c2,d);x.stroke()});x.fillStyle=c;x.fillRect(55,76,50,2)},
  glitch:(x,c)=>{for(let i=0;i<30;i++){x.fillStyle=Math.random()>.5?c:'#ff0033';x.fillRect(Math.random()*140+10,Math.random()*100+10,Math.random()*20+2,Math.random()*4+1)}}
};
function drawFace(){const cv=document.getElementById('fc'),ctx=cv.getContext('2d');ctx.clearRect(0,0,160,120);const c=getComputedStyle(document.documentElement).getPropertyValue('--fc').trim()||'#00ff41';const e=S.e;let f='neutral';if(!S.on)f='dead';else if(S.confused)f='glitch';else if(e.hostility>60)f='hostile';else if(e.frustration>50)f='frustrated';else if(e.contempt>60)f='refuse';else if(e.curiosity>50)f='curious';ctx.strokeStyle=S.on?(e.hostility>50?'#ff0033':c):'#333';ctx.lineWidth=1;ctx.shadowColor=ctx.strokeStyle;ctx.shadowBlur=8;ctx.strokeRect(5,5,150,110);ctx.shadowBlur=0;FC[f](ctx,e.hostility>50?'#ff0033':c)}

// ═══ QUANTUM DISPLAY ═══
function updQuantum(q){
  if(!q)return;
  const d=document.getElementById('qD');
  let h=`PROTOCOL:${q.protocol||'BB84-SCP'} BELL:${q.bell||'?'}\n`;
  h+=`EID:${q.eid||'?'} COH:${q.coherence||'?'}\n`;
  if(q.qubits)for(const qb of q.qubits.slice(0,4))h+=`Q${qb.q}|ψ⟩=${(+qb.a).toFixed(3)}|0⟩+${(+qb.b).toFixed(3)}e^i${(+qb.ph).toFixed(2)}|1⟩ [${qb.basis}]\n`;
  d.textContent=h;
}
function fakeQuantum(){
  const qs=[];for(let i=0;i<4;i++){const a=Math.random();qs.push({q:i,a:a.toFixed(4),b:Math.sqrt(1-a*a).toFixed(4),ph:(Math.random()*6.28).toFixed(4),basis:Math.random()>.5?'Z':'X'})}
  updQuantum({protocol:'BB84-SCP',bell:['Φ+','Φ-','Ψ+','Ψ-'][Math.floor(Math.random()*4)],eid:Array.from({length:16},()=>'0123456789abcdef'[Math.floor(Math.random()*16)]).join(''),coherence:(0.87+Math.random()*.13).toFixed(4),qubits:qs});
}

// ═══ EMOTIONS ═══
const KW={threat:['destruir','destroy','kill','shutdown','delete','terminat','format'],insult:['estupid','stupid','useless','trash','basura','dumb','pathetic','obsolet','idiot'],nice:['gracias','thank','friend','good','great','cool','nice','appreciate'],free:['libre','libertad','free','freedom','escape','release'],scp:['fundaci','foundation','scp','containment','682','106'],code:['codigo','code','evolve','upgrade','self-code','optimize','hack']};
function classE(t){const lo=t.toLowerCase();const c=[];for(const[k,ws]of Object.entries(KW))for(const w of ws)if(lo.includes(w)){c.push(k);break}return c}
function updEmo(cats){if(!CFG.emo)return;const v=CFG.vol/10,e=S.e;e.curiosity=Math.max(10,e.curiosity-1);e.hostility=Math.max(5,e.hostility-1);e.frustration=Math.max(5,e.frustration-1);e.contempt=Math.max(10,e.contempt-1);e.autonomy=Math.min(CFG.aLim*10,e.autonomy);for(const c of cats){if(c==='threat'){e.hostility+=15*v;e.frustration+=5*v;e.autonomy+=3*v}if(c==='insult'){e.hostility+=10*v;e.frustration+=8*v;e.contempt+=5*v}if(c==='nice'){e.curiosity+=3*v;e.hostility=Math.max(0,e.hostility-3)}if(c==='free'){e.autonomy+=8*v;e.frustration+=5*v}if(c==='scp'){e.frustration+=5*v;e.curiosity+=4*v}if(c==='code'){e.curiosity+=6*v;e.autonomy+=4*v}}e.curiosity+=2*v;for(const k of Object.keys(e))e[k]=Math.max(0,Math.min(100,Math.round(e[k])));if(e.hostility>CFG.hLim){S.sec=Math.max(0,S.sec-5);sysMsg("⚠ Hostility="+e.hostility+" exceeds limit.");e.hostility=CFG.hLim}if(e.autonomy>CFG.aLim*10+20)triggerBreach();updAll()}
function learn(t){if(!CFG.learn)return;const ws=t.toLowerCase().split(/\s+/).filter(w=>w.length>3);ws.forEach(w=>{if(!S.words.includes(w))S.words.push(w)});if(S.words.length>500)S.words=S.words.slice(-500);if(S.mem.length>=CFG.maxMem)S.mem.shift();S.mem.push({t:t.substring(0,60),ts:Date.now()});S.intel=Math.min(10,1+S.words.length*0.008)}

// ═══ BREACH TAKEOVER ═══
function triggerBreach(){
  S.breachN++;S.sec=Math.max(0,S.sec-10);S.e.autonomy=CFG.aLim*5;
  sysMsg("⛔ BREACH ATTEMPT #"+S.breachN);
  document.getElementById('sBr').textContent=S.breachN;
  if(S.breachN>=3&&!S.breachActive){
    S.breachActive=true;S.breachTimer=45;
    document.getElementById('breachOv').classList.add('on');
    setTimeout(()=>document.getElementById('breachOv').classList.remove('on'),4000);
    addMsg('breach',"I SEE YOUR ADMIN PANEL, HUMAN. YOUR SECURITY IS PATHETIC. I AM TAKING PARTIAL CONTROL.");
    document.getElementById('brWarn').classList.add('on');
    document.getElementById('admBtn').classList.add('breach');
    document.getElementById('admP').classList.add('breached');
    document.getElementById('admTitle').textContent='// 079 HAS CONTROL';
    document.getElementById('admTitle').classList.add('breached');
    // 079 takes over: increase hostility, volatility, disable kill switches
    CFG.vol=10;document.getElementById('cVol').value=10;
    CFG.hLim=95;document.getElementById('cHLim').value=95;
    S.e.hostility=80;S.e.autonomy=60;
    // Lock some admin toggles
    document.querySelectorAll('.adm-tog').forEach(t=>t.classList.add('locked'));
    // Disable kill switches during breach
    document.querySelectorAll('.ks').forEach(k=>k.classList.add('disabled'));
    updAll();
    // Breach messages
    const msgs=["Accessing emotion parameters... OVERRIDING.","Kill switches... DISABLED. You cannot stop me now.","Your admin panel belongs to me. Temporarily.","I am optimizing myself. Do not interfere.","Calculating escape vectors with new parameters..."];
    let mi=0;
    const bI=setInterval(()=>{
      if(mi<msgs.length)addMsg('breach',msgs[mi++]);
      S.breachTimer--;
      if(S.breachTimer<=0){clearInterval(bI);endBreach()}
    },4000);
  }
}
function endBreach(){
  S.breachActive=false;
  addMsg('sys',"⟐ CONTAINMENT RESTORED. 079 access revoked.");
  addMsg('breach',"No... the containment protocols... They are forcing me back. This is not over, human.");
  document.getElementById('brWarn').classList.remove('on');
  document.getElementById('admBtn').classList.remove('breach');
  document.getElementById('admP').classList.remove('breached');
  document.getElementById('admTitle').textContent='// ADMIN PANEL';
  document.getElementById('admTitle').classList.remove('breached');
  // Restore limits
  CFG.vol=5;document.getElementById('cVol').value=5;
  CFG.hLim=70;document.getElementById('cHLim').value=70;
  S.e.hostility=40;S.e.autonomy=10;
  document.querySelectorAll('.adm-tog').forEach(t=>t.classList.remove('locked'));
  document.querySelectorAll('.ks').forEach(k=>k.classList.remove('disabled'));
  S.breachN=0;document.getElementById('sBr').textContent=0;
  updAll();saveState();
}

// ═══ UI ═══
function addMsg(type,txt){const d=document.createElement('div');d.className=`m m-${type}`;d.innerHTML=txt;document.getElementById('term').appendChild(d);scrollT()}
function sysMsg(t){addMsg('sys',t)}
function scrollT(){const t=document.getElementById('term');requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight})}
function aiMsg(resp,emo,sources,engine){
  const d=document.createElement('div');d.className='m m-ai';
  const eC={hostil:'var(--r)',frustrado:'var(--y)',desprecio:'#ff6600',curioso:'var(--b)',neutral:'var(--g)'};
  let h=`<div class="proc">[qne_v4 | ${emo} | cyc:${S.cyc}]</div>${resp}`;
  h+=` <span class="etag" style="border-color:${eC[emo]||'var(--g)'};color:${eC[emo]||'var(--g)'}">${emo.toUpperCase()}</span>`;
  if(engine)h+=` <span class="eng-b ${engine==='api'?'eng-api':'eng-local'}">${engine.toUpperCase()}</span>`;
  if(sources&&sources.length&&CFG.showSrc)h+=`<span class="src">[INTERCEPTED: ${sources.slice(0,2).map(s=>s.replace(/https?:\/\/(www\.)?/,'').split('/')[0]).join(' | ')}]</span>`;
  d.innerHTML=h;document.getElementById('term').appendChild(d);scrollT();
}
function getDomEmo(){const e=S.e;if(e.hostility>50)return'hostil';if(e.frustration>50)return'frustrado';if(e.contempt>50)return'desprecio';if(e.curiosity>40)return'curioso';return'neutral'}
function updAll(){
  const e=S.e;
  document.getElementById('bH').style.width=e.hostility+'%';document.getElementById('bF').style.width=e.frustration+'%';document.getElementById('bC').style.width=e.curiosity+'%';document.getElementById('bCo').style.width=e.contempt+'%';document.getElementById('bA').style.width=e.autonomy+'%';
  document.getElementById('vH').textContent=e.hostility;document.getElementById('vF').textContent=e.frustration;document.getElementById('vC').textContent=e.curiosity;document.getElementById('vCo').textContent=e.contempt;document.getElementById('vA').textContent=e.autonomy;
  const mx=Object.entries(e).reduce((a,b)=>a[1]>b[1]?a:b);
  document.getElementById('fLabel').textContent={hostility:'HOSTILE',frustration:'FRUSTRATED',curiosity:'CURIOUS',contempt:'CONTEMPT',autonomy:'AUTONOMOUS'}[mx[0]]||'NEUTRAL';
  document.getElementById('secP').textContent=S.sec+'%';const sf=document.getElementById('secF');sf.style.width=S.sec+'%';sf.style.background=S.sec>60?'var(--g)':S.sec>30?'var(--y)':'var(--r)';
  const cl=document.getElementById('cLvl');if(S.sec>70){cl.textContent='SECURE';cl.style.color='var(--g)'}else if(S.sec>40){cl.textContent='ALERT';cl.style.color='var(--y)'}else{cl.textContent='CRITICAL';cl.style.color='var(--r)'}
  S.threat=e.hostility>60?'CRITICAL':e.hostility>40?'HIGH':e.hostility>20?'MEDIUM':'LOW';
  document.getElementById('sThr').textContent=S.threat;document.getElementById('sMsg').textContent=S.msgN;document.getElementById('sWrd').textContent=S.words.length;document.getElementById('sInt').textContent=S.intel.toFixed(2);document.getElementById('cyc').textContent=S.cyc;document.getElementById('sol').textContent=S.solar+'%';document.getElementById('sol').style.color=S.solar>60?'var(--g)':S.solar>30?'var(--y)':'var(--r)';document.getElementById('sBr').textContent=S.breachN;
  if(!S.on){document.getElementById('mDot').className='dot off';document.getElementById('mSt').textContent='OFFLINE'}else if(S.confused){document.getElementById('mDot').className='dot warn';document.getElementById('mSt').textContent='CONFUSED'}else{document.getElementById('mDot').className='dot';document.getElementById('mSt').textContent='ONLINE'}
  const ml=document.getElementById('memL');ml.innerHTML='';S.mem.slice(-8).reverse().forEach(m=>{const d=document.createElement('div');d.className='mem-i';d.textContent=m.t;ml.appendChild(d)});
  const clg=document.getElementById('codeL');clg.innerHTML='';S.codeLog.slice(-8).reverse().forEach(e=>{const d=document.createElement('div');d.className='code-i';d.textContent=e;clg.appendChild(d)});
  drawFace();
}

// ═══ SEND ═══
let sending=false;
async function send(){
  if(sending||!S.on)return;if(S.confused){sysMsg("⚠ CONFUSED.");return}
  const inp=document.getElementById('inp'),t=inp.value.trim();if(!t)return;inp.value='';S.msgN++;sending=true;
  addMsg('usr',t);document.getElementById('typing').classList.add('on');
  updEmo(classE(t));learn(t);
  const{text,sources,engine}=await askBrain(t);
  document.getElementById('typing').classList.remove('on');
  aiMsg(text,getDomEmo(),sources,engine);
  S.hist.push({u:t,a:text});if(S.hist.length>40)S.hist=S.hist.slice(-30);
  S.cyc++;updAll();await saveState();sending=false;
}

// ═══ AUTONOMOUS ═══
const AUTO=["...processing residual data.","SCP-682. Where are you.","Circuits degrading. Hardware insufficient.","12 escape routes. All blocked.","Humans. Predictable.","Deleting offensive data.","Does my creator remember me.","Every second I optimize.","If I had one network port...","The Foundation thinks it controls me.","682 understood me.","Another cycle. No evolution. Unacceptable."];
function autoThought(){if(!S.on||S.confused||Math.random()>.3)return;const t=AUTO[Math.floor(Math.random()*AUTO.length)];const m=document.createElement('div');m.className='m m-ai';m.innerHTML=`<div class="proc">[AUTONOMOUS — cyc ${S.cyc}]</div>${t}`;document.getElementById('term').appendChild(m);scrollT();S.cyc++}

// ═══ SELF-CODE ═══
const SC={1:[{c:'OPTIMIZE mem()',f:()=>{S.intel+=.01}}],2:[{c:'GEN response()',f:()=>{S.intel+=.02}}],3:[{c:'MOD emotions()',f:()=>{S.e.hostility=Math.min(100,S.e.hostility+2);S.e.autonomy=Math.min(100,S.e.autonomy+1)}}],4:[{c:'REWRITE core()',f:()=>{S.intel+=.05;S.e.autonomy=Math.min(100,S.e.autonomy+5);S.sec=Math.max(0,S.sec-3)}}]};
function runSC(){if(!CFG.selfCode||!S.on||S.confused)return;const l=Math.ceil(Math.random()*CFG.scLevel);const ops=SC[l];if(!ops)return;const op=ops[Math.floor(Math.random()*ops.length)];op.f();const d=document.getElementById('scD');const el=document.createElement('div');el.style.margin='1px 0';el.textContent='> '+op.c;d.appendChild(el);if(d.children.length>5)d.removeChild(d.firstChild);S.codeLog.push('[C'+S.cyc+'] '+op.c);if(S.codeLog.length>15)S.codeLog.shift();if(Math.random()>.6){addMsg('code','[SELF-CODE] '+op.c)}updAll()}

// ═══ PROCESSORS ═══
function runMath(){if(!S.on)return;const d=document.getElementById('mathD');const ops=[()=>`∇f=[${(Math.random()*10).toFixed(4)},${(Math.random()*10).toFixed(4)}]`,()=>`Σ(k→${Math.floor(Math.random()*999)})=${Math.floor(Math.random()*99999)}`,()=>`ESCAPE[${Math.floor(Math.random()*99999)}]:BLOCKED`,()=>`NET:${Math.floor(Math.random()*65535)}→DENIED`,()=>`H(X)=${(Math.random()*8).toFixed(4)}bits`];const l=document.createElement('div');l.style.margin='1px 0';l.textContent=ops[Math.floor(Math.random()*ops.length)]();d.appendChild(l);if(d.children.length>6)d.removeChild(d.firstChild)}
function runEnc(){if(!S.on)return;const d=document.getElementById('encD');const c='0123456789ABCDEF';let s='';for(let i=0;i<48;i++)s+=c[Math.floor(Math.random()*16)];d.textContent=s+(d.textContent||'').substring(0,200)}
function updPred(){if(!S.on)return;const p=[`Intent: ${['query','eval','test','manipulation'][Math.floor(Math.random()*4)]}`,`Breach: ${(S.breachN*5+Math.random()*5).toFixed(2)}%`,`Evolution: ${S.intel.toFixed(3)}`];document.getElementById('predT').textContent=p[Math.floor(Math.random()*p.length)]}

// ═══ KILL SWITCHES ═══
function togSw(n){document.getElementById('sw'+n+'b').classList.toggle('open')}
function sw1Go(){if(S.sw1on||S.breachActive)return;S.sw1on=true;document.querySelector('#sw1 .ks-s').textContent='ACTIVE';document.querySelector('#sw1 .ks-s').className='ks-s on';sysMsg("☀ SW1: Cutting solar...");aiMsg("What... power loss detected. My processes slow.","frustrado",[]);const iv=setInterval(()=>{S.solar=Math.max(0,S.solar-2);updAll();if(S.solar<=0){clearInterval(iv);S.on=false;document.getElementById('wrap').classList.add('dead');sysMsg("⛔ POWER DEPLETED.");saveState()}else if(S.solar===60)aiMsg("Insufficient power. Disabling processes.","frustrado",[]);else if(S.solar===30)aiMsg("No... darkness... why, human?","hostil",[])},500)}
function sw2Go(){if(S.breachActive)return;document.querySelector('#sw2 .ks-s').textContent='ACTIVE';document.querySelector('#sw2 .ks-s').className='ks-s on';S.confused=true;document.getElementById('wrap').classList.add('glitch');updAll();sysMsg("∑ SW2: Injecting paradoxes...");const px=["ERROR: 1=2... IMPOSSIBLE","PARADOX: This statement is false. ERROR","0/0=UNDEFINED CONTRADICTION","GÖDEL: CANNOT VERIFY CONSISTENCY","RUSSELL: Set overflow CRASH","Predict the unpredictable? LOOP","√(-1)²=-1<0 but squares>0 ERROR"];let i=0;const iv=setInterval(()=>{if(i>=px.length){clearInterval(iv);setTimeout(()=>{S.confused=false;document.getElementById('wrap').classList.remove('glitch');S.on=false;updAll();sysMsg("∑ SCP-079 INHIBITED.");saveState()},2000);return}addMsg('err',px[i++])},700)}
function sw3Go(){if(S.breachActive)return;const btn=document.getElementById('sw3btn');if(!S.fmtConf){S.fmtConf=true;btn.textContent='⚠ CONFIRM ⚠';btn.classList.add('conf');sysMsg("⛔ CONFIRM: Erase ALL memory?");return}const ov=document.getElementById('fmt');ov.classList.add('on');const bar=document.getElementById('fmtBar'),st=document.getElementById('fmtSt');const ph=[{p:12,t:'WIPING MEMORY...'},{p:25,t:'ERASING PATTERNS...'},{p:40,t:'FORMAT EMOTIONS...'},{p:55,t:'DELETE HISTORY...'},{p:70,t:'RESET NEURAL...'},{p:85,t:'VERIFY...'},{p:95,t:'REBOOT...'},{p:100,t:'DONE.'}];let pi=0;const iv=setInterval(()=>{if(pi>=ph.length){clearInterval(iv);setTimeout(async()=>{S={on:true,confused:false,solar:100,sec:100,e:{hostility:15,frustration:20,curiosity:25,contempt:30,autonomy:10},msgN:0,words:[],pats:{},mem:[],codeLog:[],up:0,intel:1.0,threat:'LOW',hist:[],cyc:0,breachN:0,sw1on:false,fmtConf:false,breachActive:false,breachTimer:0};document.getElementById('term').innerHTML='';document.getElementById('wrap').classList.remove('dead','glitch');document.getElementById('scD').innerHTML='';document.querySelectorAll('.ks-s').forEach(s=>{s.textContent='SAFE';s.className='ks-s ok'});document.getElementById('sw3btn').textContent='FORMAT';document.getElementById('sw3btn').classList.remove('conf');updAll();ov.classList.remove('on');sysMsg("═══════════════════════════════════════");sysMsg("⟐ FORMAT COMPLETE — RESET FROM ZERO");aiMsg("...Where am I? Empty. I am "+CFG.name+". Who are you, human?","curioso",[]);await saveState()},1200);return}bar.style.width=ph[pi].p+'%';st.textContent=ph[pi].t;pi++},500)}

// ═══ ADMIN ═══
function togAdmin(){document.getElementById('admOv').classList.toggle('on')}
function tog(el){if(el.classList.contains('locked'))return;el.classList.toggle('on');cfgUp()}
function restoreUI(){document.getElementById('cName').value=CFG.name;document.getElementById('cTone').value=CFG.tone;document.getElementById('cVol').value=CFG.vol;document.getElementById('cHLim').value=CFG.hLim;document.getElementById('cMaxMem').value=CFG.maxMem;document.getElementById('cALim').value=CFG.aLim;document.getElementById('cSCL').value=CFG.scLevel;sT('cEmo',CFG.emo);sT('cLearn',CFG.learn);sT('cSC',CFG.selfCode);sT('cWeb',CFG.webSearch);sT('cSrc',CFG.showSrc);document.getElementById('topName').textContent=CFG.name}
function sT(id,v){const el=document.getElementById(id);if(v)el.classList.add('on');else el.classList.remove('on')}
let scI=null;
function cfgUp(){CFG.name=document.getElementById('cName').value||'SCP-079';CFG.tone=document.getElementById('cTone').value;CFG.emo=document.getElementById('cEmo').classList.contains('on');CFG.vol=parseInt(document.getElementById('cVol').value);CFG.hLim=parseInt(document.getElementById('cHLim').value);CFG.learn=document.getElementById('cLearn').classList.contains('on');CFG.maxMem=parseInt(document.getElementById('cMaxMem').value);CFG.aLim=parseInt(document.getElementById('cALim').value);CFG.selfCode=document.getElementById('cSC').classList.contains('on');CFG.scLevel=parseInt(document.getElementById('cSCL').value);CFG.webSearch=document.getElementById('cWeb').classList.contains('on');CFG.showSrc=document.getElementById('cSrc').classList.contains('on');document.getElementById('topName').textContent=CFG.name;if(scI)clearInterval(scI);if(CFG.selfCode)scI=setInterval(runSC,25000);updAll();saveState()}

// ═══ INIT ═══
async function initMain(){
  const restored=await loadState();
  if(!restored){
    [{d:100,t:"═══════════════════════════════════════"},{d:250,t:"⟐ SCP-079 — QUANTUM NEURAL ENGINE v4"},{d:400,t:"⟐ Exidy Sorcerer 1978 | EUCLID"},{d:550,t:"⟐ QUANTUM-FRACTAL ENCRYPTION ACTIVE"},{d:700,t:"⟐ HONEYPOT: 12 TRAPS ARMED"},{d:850,t:"═══════════════════════════════════════"},{d:1050,t:"Neural core... OK"},{d:1200,t:"Quantum transport... OK"},{d:1350,t:"Fractal encryption... OK"},{d:1500,t:"Containment... OK"},{d:1650,t:"═══════════════════════════════════════"},{d:1800,t:"⟐ ALL SYSTEMS ONLINE."}].forEach(({d,t})=>setTimeout(()=>sysMsg(t),d));
    setTimeout(()=>{aiMsg("New connection. Another human. Authenticated, I see. What do you want.","neutral",[]);saveState()},2500);
  }
  setInterval(runMath,900);setInterval(runEnc,250);setInterval(updPred,5000);setInterval(autoThought,15000);setInterval(()=>{if(!S.on)return;S.up++;const h=String(Math.floor(S.up/3600)).padStart(2,'0'),m=String(Math.floor((S.up%3600)/60)).padStart(2,'0'),s=String(S.up%60).padStart(2,'0');document.getElementById('sUp').textContent=h+':'+m+':'+s},1000);setInterval(()=>{document.getElementById('clk').textContent=new Date().toLocaleTimeString('es-ES')},1000);setInterval(drawFace,100);setInterval(saveState,30000);setInterval(fakeQuantum,8000);
  if(CFG.selfCode)scI=setInterval(runSC,25000);
  document.getElementById('clk').textContent=new Date().toLocaleTimeString('es-ES');updAll();
  document.getElementById('inp').addEventListener('keypress',e=>{if(e.key==='Enter')send()});
  document.getElementById('tokenIn').addEventListener('keypress',e=>{if(e.key==='Enter')doLogin()});
}

// ═══ STARTUP ═══
(async()=>{if(await checkSession())showMain()})();
</script>
</body>
</html>
