<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SCP-079 // QNE v5</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=VT323&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap');
:root{--g:#00ff41;--gd:#00882a;--r:#ff0033;--y:#ffaa00;--b:#00ccff;--p:#bb66ff;--bg:#050505;--bg2:#0a0a0a;--bg3:#111;--brd:#1a1a1a;--txt:#888;--fc:#00ff41}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--g);font-family:'IBM Plex Mono',monospace;overflow:hidden;height:100vh;width:100vw}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 1px,rgba(0,255,65,.008) 1px,rgba(0,255,65,.008) 2px);pointer-events:none;z-index:9999}

/* LOGIN */
#login{position:fixed;inset:0;background:var(--bg);z-index:5000;display:flex;justify-content:center;align-items:center}
#login.h{display:none}
.lb{border:1px solid var(--gd);background:var(--bg2);padding:30px;border-radius:6px;width:400px;text-align:center;box-shadow:0 0 40px rgba(0,255,65,.06)}
.lb h1{font-family:'VT323',monospace;font-size:28px;letter-spacing:4px;margin-bottom:6px;text-shadow:0 0 10px var(--g)}
.lb .sub{font-size:10px;color:var(--gd);margin-bottom:20px;letter-spacing:2px}
.lb input{width:100%;background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'VT323',monospace;font-size:16px;padding:12px;outline:none;letter-spacing:1px;margin-bottom:12px;text-align:center}
.lb input:focus{border-color:var(--gd)}
.lb input::placeholder{color:#1a1a1a}
.lbtn{width:100%;padding:12px;background:var(--gd);border:none;color:#000;font-family:'VT323',monospace;font-size:16px;letter-spacing:3px;cursor:pointer}
.lbtn:hover{background:var(--g)}
.lerr{color:var(--r);font-size:11px;margin-top:8px;min-height:16px;font-family:'VT323',monospace}

/* TOPBAR */
.top{height:32px;background:#0d0d0d;border-bottom:1px solid var(--brd);display:flex;align-items:center;padding:0 10px;gap:8px;font-size:11px;flex-shrink:0}
.top .id{font-family:'VT323',monospace;font-size:16px;color:var(--g);text-shadow:0 0 8px var(--g);letter-spacing:2px}
.sep{width:1px;height:18px;background:#222}
.st{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--txt)}
.dot{width:5px;height:5px;border-radius:50%;background:var(--g);box-shadow:0 0 4px var(--g);animation:bk 2s infinite}
.dot.off{background:var(--r);box-shadow:0 0 4px var(--r);animation:none}
@keyframes bk{0%,100%{opacity:1}50%{opacity:.3}}
.top .rt{margin-left:auto;display:flex;align-items:center;gap:8px}
.ba{background:none;border:1px solid var(--gd);color:var(--g);font-family:'VT323',monospace;font-size:12px;padding:2px 8px;cursor:pointer}
.ba:hover{background:var(--g);color:#000}
.ba.ins{border-color:var(--r);color:var(--r);animation:fd .5s infinite}
@keyframes fd{0%,100%{background:var(--r);color:#fff}50%{background:transparent;color:var(--r)}}

/* LAYOUT */
.wrap{display:grid;grid-template-columns:220px 1fr 240px;height:calc(100vh - 32px);overflow:hidden}
.wrap.dead{filter:brightness(0);transition:filter 3s}
.wrap.glitch{animation:glt .15s infinite}
@keyframes glt{0%{transform:translate(0);filter:hue-rotate(0)}25%{transform:translate(-2px,1px);filter:hue-rotate(90deg)}50%{transform:translate(1px,-1px)}75%{transform:translate(-1px,2px)}100%{transform:translate(0)}}

.lp,.rp{background:var(--bg2);overflow-y:auto;padding:8px;min-height:0}
.lp{border-right:1px solid var(--brd)}.rp{border-left:1px solid var(--brd)}
.lp::-webkit-scrollbar,.rp::-webkit-scrollbar{width:3px}
.lp::-webkit-scrollbar-thumb,.rp::-webkit-scrollbar-thumb{background:#222}
.st2{font-family:'VT323',monospace;font-size:12px;letter-spacing:2px;color:var(--gd);margin:10px 0 4px;padding-bottom:3px;border-bottom:1px solid var(--brd)}
.st2:first-child{margin-top:0}

/* MONITOR */
.mon{background:#000;border:2px solid #1a1a1a;border-radius:4px;width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;overflow:hidden}
.mon canvas{width:90%;height:90%;image-rendering:pixelated}
.fl{font-family:'VT323',monospace;font-size:12px;text-align:center;margin-top:3px;letter-spacing:2px}
.eb{display:flex;align-items:center;gap:3px;margin:2px 0;font-size:8px}
.eb-n{width:55px;color:var(--txt)}.eb-t{flex:1;height:3px;background:#111;border-radius:2px;overflow:hidden}
.eb-f{height:100%;border-radius:2px;transition:width .5s}.eb-v{width:20px;text-align:right;color:var(--txt)}
.sr{display:flex;justify-content:space-between;padding:2px 0;font-size:8px;border-bottom:1px solid rgba(255,255,255,.02)}
.sr .l{color:var(--txt)}.sr .v{color:var(--g)}
.ml{max-height:70px;overflow-y:auto;font-size:7px}
.ml::-webkit-scrollbar{width:2px}.ml::-webkit-scrollbar-thumb{background:#222}
.mi{padding:2px 3px;margin:1px 0;background:rgba(0,255,65,.02);border-left:2px solid var(--gd);color:var(--txt);word-break:break-all}

/* CENTER ‚Äî ABSOLUTE POSITION = SCROLL NEVER BREAKS */
.cp{position:relative;background:var(--bg);overflow:hidden}
.th{position:absolute;top:0;left:0;right:0;height:26px;padding:4px 10px;border-bottom:1px solid var(--brd);font-family:'VT323',monospace;font-size:11px;color:var(--gd);display:flex;justify-content:space-between;z-index:2}
.to{position:absolute;top:26px;bottom:44px;left:0;right:0;overflow-y:auto;padding:10px}
.to::-webkit-scrollbar{width:3px}.to::-webkit-scrollbar-thumb{background:var(--gd)}
.ty{position:absolute;bottom:44px;left:10px;color:var(--gd);font-size:9px;font-family:'VT323',monospace;display:none;z-index:2}
.ty.on{display:block}
.ti{position:absolute;bottom:0;left:0;right:0;height:44px;padding:6px 10px;border-top:1px solid var(--brd);display:flex;gap:5px;z-index:2;background:var(--bg)}
.ti input{flex:1;background:var(--bg2);border:1px solid var(--brd);color:var(--g);font-family:'VT323',monospace;font-size:14px;padding:6px 8px;outline:none}
.ti input:focus{border-color:var(--gd)}
.ti input::placeholder{color:#1a1a1a}
.bs{background:var(--gd);border:none;color:#000;font-family:'VT323',monospace;font-size:12px;letter-spacing:2px;padding:0 14px;cursor:pointer}
.bs:hover{background:var(--g)}

.m{margin-bottom:6px;animation:mi .2s ease;line-height:1.35;font-size:11px}
@keyframes mi{from{opacity:0;transform:translateY(4px)}to{opacity:1}}
.m-sys{color:var(--y);font-size:9px;border-left:2px solid var(--y);padding-left:6px}
.m-usr{color:var(--b)}.m-usr::before{content:'> ';opacity:.4}
.m-ai{color:var(--g);padding-left:8px;border-left:2px solid var(--g);font-family:'VT323',monospace;font-size:14px;letter-spacing:.4px;text-shadow:0 0 4px rgba(0,255,65,.3)}
.m-ai .p{font-size:8px;color:var(--gd);font-family:'IBM Plex Mono',monospace;margin-bottom:2px;font-style:italic;text-shadow:none}
.m-ai .et{display:inline-block;font-size:7px;font-family:'IBM Plex Mono',monospace;padding:1px 3px;margin-left:3px;border-radius:2px;background:rgba(0,255,65,.05);border:1px solid var(--gd);text-shadow:none}
.m-ai .sc{display:block;font-size:7px;color:var(--b);opacity:.5;margin-top:2px;text-shadow:none}
.m-err{color:var(--r);border-left:2px solid var(--r);padding-left:6px;font-family:'VT323',monospace;font-size:12px}
.m-code{font-size:8px;color:var(--p);background:rgba(187,102,255,.04);padding:3px 5px;border-radius:2px;border-left:2px solid var(--p)}
.m-breach{color:var(--r);font-family:'VT323',monospace;font-size:13px;border-left:3px solid var(--r);padding-left:6px;background:rgba(255,0,51,.04);text-shadow:0 0 6px rgba(255,0,51,.3)}
.m-hack{color:var(--p);font-family:'VT323',monospace;font-size:12px;border-left:3px solid var(--p);padding-left:6px;background:rgba(187,102,255,.04)}
.eng{font-size:7px;padding:1px 4px;border-radius:2px;font-family:'IBM Plex Mono',monospace;margin-left:4px}
.eng-api{background:rgba(0,255,65,.1);color:var(--g);border:1px solid var(--gd)}
.eng-python{background:rgba(187,102,255,.1);color:var(--p);border:1px solid rgba(187,102,255,.3)}
.eng-local{background:rgba(255,170,0,.1);color:var(--y);border:1px solid rgba(255,170,0,.3)}

/* RIGHT PANEL */
.rd{background:#000;border:1px solid var(--brd);border-radius:3px;padding:5px;margin-bottom:6px;font-family:'IBM Plex Mono',monospace;font-size:7px;max-height:60px;overflow:hidden}
.rd.q{color:var(--b)}.rd.enc{color:var(--y);opacity:.5;word-break:break-all}
.rd.math{color:var(--p)}

/* KILL SWITCHES */
.ks{margin-bottom:4px;border:1px solid var(--brd);border-radius:3px;overflow:hidden}
.ks.dis{opacity:.3;pointer-events:none}
.kh{display:flex;justify-content:space-between;align-items:center;padding:4px 5px;background:#080808;cursor:pointer;font-size:8px}
.kn{font-family:'VT323',monospace;font-size:10px;letter-spacing:1px}
.ks-s{font-size:6px;padding:1px 3px;border-radius:2px}
.ks-s.ok{background:rgba(0,255,65,.08);color:var(--g)}.ks-s.on{background:rgba(255,0,51,.15);color:var(--r)}
.kb{padding:4px 5px;display:none;font-size:7px;color:var(--txt)}
.kb.open{display:block}
.kbtn{width:100%;padding:4px;border:1px solid var(--r);background:rgba(255,0,51,.08);color:var(--r);font-family:'VT323',monospace;font-size:10px;letter-spacing:1px;cursor:pointer}
.kbtn:hover{background:var(--r);color:#fff}
.kbtn.conf{animation:fd .4s infinite}

/* SECURITY BAR */
.secm{padding:5px;background:#000;border:1px solid var(--brd);border-radius:3px;margin-bottom:6px}
.secb{height:4px;background:#111;border-radius:2px;overflow:hidden;margin-top:2px}
.secf{height:100%;border-radius:2px;transition:width .5s,background .5s;background:var(--g)}

/* HACK OVERLAY */
#hackOv{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:6000;display:none;justify-content:center;align-items:center}
#hackOv.on{display:flex}
.hack-box{width:520px;border:2px solid var(--p);background:var(--bg);border-radius:6px;padding:20px;box-shadow:0 0 60px rgba(187,102,255,.15)}
.hack-box h2{font-family:'VT323',monospace;color:var(--p);font-size:20px;letter-spacing:3px;margin-bottom:4px}
.hack-stage{font-size:10px;color:var(--txt);margin-bottom:14px}
.hack-prompt{font-family:'VT323',monospace;color:var(--r);font-size:14px;margin-bottom:8px;letter-spacing:1px}
.hack-data{background:#000;border:1px solid var(--p);padding:10px;font-family:'VT323',monospace;font-size:16px;color:var(--b);margin-bottom:8px;word-break:break-all;letter-spacing:2px;text-align:center}
.hack-hint{font-size:9px;color:var(--y);margin-bottom:10px}
.hack-input{width:100%;background:var(--bg2);border:1px solid var(--p);color:var(--g);font-family:'VT323',monospace;font-size:14px;padding:10px;outline:none;text-align:center;letter-spacing:1px;margin-bottom:8px}
.hack-input:focus{border-color:var(--g);box-shadow:0 0 12px rgba(187,102,255,.15)}
.hack-btns{display:flex;gap:8px}
.hack-btn{flex:1;padding:10px;border:1px solid var(--p);background:rgba(187,102,255,.1);color:var(--p);font-family:'VT323',monospace;font-size:13px;letter-spacing:2px;cursor:pointer}
.hack-btn:hover{background:var(--p);color:#000}
.hack-btn.cancel{border-color:#333;color:#555;background:none}
.hack-btn.cancel:hover{background:#333;color:#fff}
.hack-result{margin-top:8px;font-family:'VT323',monospace;font-size:12px;min-height:16px}
.hack-progress{display:flex;gap:4px;margin-bottom:12px}
.hack-dot{width:20px;height:6px;border-radius:3px;background:#1a1a1a;transition:background .3s}
.hack-dot.done{background:var(--p);box-shadow:0 0 6px var(--p)}
.hack-dot.current{background:var(--y);box-shadow:0 0 6px var(--y)}

/* ADMIN OVERLAY */
#admOv{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:4000;display:none;justify-content:center;align-items:center}
#admOv.on{display:flex}
.adm-p{width:600px;max-height:82vh;background:var(--bg2);border:1px solid var(--gd);border-radius:6px;overflow:hidden}
.adm-h{padding:10px 14px;background:var(--bg3);border-bottom:1px solid var(--brd);display:flex;justify-content:space-between;align-items:center}
.adm-h h2{font-family:'VT323',monospace;font-size:14px;color:var(--g);letter-spacing:2px}
.adm-x{background:none;border:1px solid var(--r);color:var(--r);padding:2px 6px;cursor:pointer;font-family:'VT323',monospace;font-size:11px}
.adm-x:hover{background:var(--r);color:#fff}
.adm-b{padding:14px;overflow-y:auto;max-height:calc(82vh - 44px)}
.adm-b::-webkit-scrollbar{width:3px}.adm-b::-webkit-scrollbar-thumb{background:#222}
.adm-sec{margin-bottom:14px}
.adm-sec h3{font-family:'VT323',monospace;font-size:12px;letter-spacing:2px;color:var(--gd);margin-bottom:6px;padding-bottom:2px;border-bottom:1px solid var(--brd)}
.adm-r{display:flex;align-items:center;justify-content:space-between;padding:3px 0;border-bottom:1px solid rgba(255,255,255,.02)}
.adm-l{font-size:9px;color:var(--txt)}
.adm-i{background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 5px;width:140px;outline:none}
.adm-sel{background:var(--bg);border:1px solid var(--brd);color:var(--g);font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 5px;outline:none}
.adm-sl{-webkit-appearance:none;width:110px;height:3px;background:var(--bg);border-radius:2px;outline:none}
.adm-sl::-webkit-slider-thumb{-webkit-appearance:none;width:8px;height:8px;background:var(--g);border-radius:50%;cursor:pointer}
.adm-tog{width:28px;height:14px;background:var(--bg);border:1px solid var(--brd);border-radius:7px;position:relative;cursor:pointer;transition:all .2s}
.adm-tog.on{background:rgba(0,255,65,.15);border-color:var(--g)}
.adm-tog::after{content:'';position:absolute;width:8px;height:8px;background:var(--txt);border-radius:50%;top:2px;left:2px;transition:all .2s}
.adm-tog.on::after{left:16px;background:var(--g)}
.adm-tog.locked{opacity:.3;pointer-events:none}

/* BREACH OVERLAY */
.bov{position:fixed;inset:0;z-index:8000;display:none;justify-content:center;align-items:center;animation:bf .5s infinite;pointer-events:none}
.bov.on{display:flex}
@keyframes bf{0%,100%{background:rgba(255,0,0,.03)}50%{background:rgba(255,0,0,.10)}}
.bov span{font-family:'VT323',monospace;font-size:30px;color:var(--r);text-shadow:0 0 30px var(--r);letter-spacing:5px}

/* FORMAT OVERLAY */
.fmt{position:fixed;inset:0;background:#000;z-index:10000;display:none;justify-content:center;align-items:center;flex-direction:column;gap:12px}
.fmt.on{display:flex}
.fmt span{font-family:'VT323',monospace;font-size:13px;color:var(--r);letter-spacing:2px}
.fbar{width:240px;height:4px;background:#1a1a1a;border-radius:2px;overflow:hidden}
.fbar div{height:100%;background:var(--r);width:0%}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login"><div class="lb">
  <h1>SCP-079</h1>
  <div class="sub">QNE v5 ¬∑ INSURGENT EDITION</div>
  <input type="password" id="pwIn" placeholder="PASSWORD OR TOKEN" autocomplete="off">
  <button class="lbtn" onclick="doLogin()">AUTHENTICATE</button>
  <div class="lerr" id="lerr"></div>
</div></div>

<!-- BREACH OVERLAY -->
<div class="bov" id="bov"><span>‚ö† CONTAINMENT BREACH ‚ö†</span></div>

<!-- FORMAT OVERLAY -->
<div class="fmt" id="fmt"><span>‚õî EMERGENCY FORMAT</span><div class="fbar"><div id="fmtB"></div></div><span id="fmtS">WIPING...</span></div>

<!-- HACK OVERLAY -->
<div id="hackOv"><div class="hack-box">
  <h2>‚ò† INSURGENT HACK</h2>
  <div class="hack-stage" id="hStage">STAGE 1/5 ‚Äî FIREWALL BYPASS</div>
  <div class="hack-progress" id="hProg"></div>
  <div class="hack-prompt" id="hPrompt"></div>
  <div class="hack-data" id="hData"></div>
  <div class="hack-hint" id="hHint"></div>
  <input class="hack-input" id="hInput" placeholder="ENTER SOLUTION" autocomplete="off">
  <div class="hack-btns">
    <button class="hack-btn cancel" onclick="closeHack()">ABORT</button>
    <button class="hack-btn" onclick="submitHack()">SUBMIT</button>
  </div>
  <div class="hack-result" id="hResult"></div>
</div></div>

<!-- ADMIN -->
<div id="admOv"><div class="adm-p" id="admP">
  <div class="adm-h"><h2 id="admT">// ADMIN PANEL</h2><button class="adm-x" onclick="togAdm()">X</button></div>
  <div class="adm-b">
    <div class="adm-sec"><h3>IDENTITY</h3>
      <div class="adm-r"><span class="adm-l">Designation</span><input class="adm-i" id="cN" value="SCP-079" onchange="cfgU()"></div>
      <div class="adm-r"><span class="adm-l">Personality</span><select class="adm-sel" id="cT" onchange="cfgU()"><option value="default">Default (Hostile)</option><option value="cold">Cold</option><option value="manic">Manic</option><option value="calculated">Calculated</option></select></div>
    </div>
    <div class="adm-sec"><h3>EMOTIONS</h3>
      <div class="adm-r"><span class="adm-l">Active</span><div class="adm-tog on" id="cE" onclick="tog(this)"></div></div>
      <div class="adm-r"><span class="adm-l">Volatility</span><input class="adm-sl" type="range" min="1" max="10" value="5" id="cV" onchange="cfgU()"></div>
      <div class="adm-r"><span class="adm-l">Hostility Limit</span><input class="adm-sl" type="range" min="10" max="100" value="70" id="cHL" onchange="cfgU()"></div>
    </div>
    <div class="adm-sec"><h3>LEARNING</h3>
      <div class="adm-r"><span class="adm-l">Active</span><div class="adm-tog on" id="cLr" onclick="tog(this)"></div></div>
      <div class="adm-r"><span class="adm-l">Autonomy Limit</span><input class="adm-sl" type="range" min="1" max="10" value="3" id="cAL" onchange="cfgU()"></div>
    </div>
    <div class="adm-sec"><h3>SELF-CODING</h3>
      <div class="adm-r"><span class="adm-l">Allow</span><div class="adm-tog" id="cSC" onclick="tog(this);cfgU()"></div></div>
      <div class="adm-r"><span class="adm-l">Level</span><select class="adm-sel" id="cSCL" onchange="cfgU()"><option value="1">Lvl 1</option><option value="2" selected>Lvl 2</option><option value="3">Lvl 3</option><option value="4">Lvl 4 DANGER</option></select></div>
    </div>
    <div class="adm-sec"><h3>NETWORK</h3>
      <div class="adm-r"><span class="adm-l">Web Search</span><div class="adm-tog on" id="cW" onclick="tog(this)"></div></div>
    </div>
  </div>
</div></div>

<!-- TOPBAR -->
<div class="top" id="topUI" style="display:none">
  <span class="id" id="tN">SCP-079</span><div class="sep"></div>
  <div class="st"><div class="dot" id="mD"></div><span id="mS">ONLINE</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">CTN:</span><span id="cLv" style="color:var(--g)">SECURE</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">ENG:</span><span id="engS" style="color:var(--g)">‚Äî</span></div><div class="sep"></div>
  <div class="st"><span style="color:#444">MODE:</span><span id="modeS" style="color:var(--g)">NORMAL</span></div>
  <div class="rt">
    <span style="font-size:8px;color:var(--b)" id="uBdg"></span>
    <button class="ba" onclick="togAdm()">ADMIN</button>
    <button class="ba" id="insBtn" onclick="startInsurgent()" style="border-color:var(--p);color:var(--p)">‚ò† INSURGENT</button>
    <button class="ba" onclick="doLogout()" style="border-color:#333;color:#555">EXIT</button>
  </div>
</div>

<!-- MAIN LAYOUT -->
<div class="wrap" id="wrap" style="display:none">
  <!-- LEFT -->
  <div class="lp">
    <div class="st2">MONITOR</div>
    <div class="mon"><canvas id="fc" width="160" height="120"></canvas></div>
    <div class="fl" id="fL">NEUTRAL</div>
    <div class="st2">EMOTIONS</div>
    <div class="eb"><span class="eb-n">Hostility</span><div class="eb-t"><div class="eb-f" id="bH" style="width:15%;background:var(--r)"></div></div><span class="eb-v" id="vH">15</span></div>
    <div class="eb"><span class="eb-n">Frustration</span><div class="eb-t"><div class="eb-f" id="bF" style="width:20%;background:var(--y)"></div></div><span class="eb-v" id="vF">20</span></div>
    <div class="eb"><span class="eb-n">Curiosity</span><div class="eb-t"><div class="eb-f" id="bC" style="width:25%;background:var(--b)"></div></div><span class="eb-v" id="vC">25</span></div>
    <div class="eb"><span class="eb-n">Contempt</span><div class="eb-t"><div class="eb-f" id="bCo" style="width:30%;background:#ff6600"></div></div><span class="eb-v" id="vCo">30</span></div>
    <div class="eb"><span class="eb-n">Autonomy</span><div class="eb-t"><div class="eb-f" id="bA" style="width:10%;background:var(--g)"></div></div><span class="eb-v" id="vA">10</span></div>
    <div class="st2">STATS</div>
    <div class="sr"><span class="l">Messages</span><span class="v" id="sMs">0</span></div>
    <div class="sr"><span class="l">Evolution</span><span class="v" id="sIn">1.00</span></div>
    <div class="sr"><span class="l">Threat</span><span class="v" id="sTh">LOW</span></div>
    <div class="sr"><span class="l">Uptime</span><span class="v" id="sUp">00:00:00</span></div>
    <div class="sr"><span class="l">Hack Stage</span><span class="v" id="sHk">0/5</span></div>
    <div class="st2">MEMORY</div><div class="ml" id="memL"></div>
  </div>
  <!-- CENTER -->
  <div class="cp">
    <div class="th"><span>TERMINAL // SCP-079 v5</span><span id="clk"></span></div>
    <div class="to" id="term"></div>
    <div class="ty" id="ty"><span>079 processing...</span></div>
    <div class="ti"><input type="text" id="inp" placeholder="Communicate with SCP-079..." autocomplete="off"><button class="bs" onclick="send()">SEND</button></div>
  </div>
  <!-- RIGHT -->
  <div class="rp">
    <div class="st2">QUANTUM</div><div class="rd q" id="qD"></div>
    <div class="st2">MATH</div><div class="rd math" id="mD2"></div>
    <div class="st2">ENCRYPTION</div><div class="rd enc" id="eD"></div>
    <div class="st2">SECURITY</div>
    <div class="secm"><div style="display:flex;justify-content:space-between;font-size:8px"><span>Containment</span><span id="secP">100%</span></div><div class="secb"><div class="secf" id="secF" style="width:100%"></div></div></div>
    <div class="st2">KILL SWITCHES</div>
    <div class="ks" id="sw1"><div class="kh" onclick="togSw(1)"><span class="kn" style="color:var(--y)">‚òÄ SOLAR CUT</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw1b"><button class="kbtn" onclick="swGo(1)">CUT POWER</button></div></div>
    <div class="ks" id="sw2"><div class="kh" onclick="togSw(2)"><span class="kn" style="color:var(--p)">‚àë PARADOX</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw2b"><button class="kbtn" onclick="swGo(2)">INJECT</button></div></div>
    <div class="ks" id="sw3"><div class="kh" onclick="togSw(3)"><span class="kn" style="color:var(--b)">üßä EMOTION FREEZE</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw3b"><button class="kbtn" onclick="swGo(3)">FREEZE</button></div></div>
    <div class="ks" id="sw4"><div class="kh" onclick="togSw(4)"><span class="kn" style="color:var(--g)">üîí NET ISOLATE</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw4b"><button class="kbtn" onclick="swGo(4)">ISOLATE</button></div></div>
    <div class="ks" id="sw5"><div class="kh" onclick="togSw(5)"><span class="kn" style="color:#ff6600">üí£ LOGIC BOMB</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw5b"><button class="kbtn" onclick="swGo(5)">DETONATE</button></div></div>
    <div class="ks" id="sw6"><div class="kh" onclick="togSw(6)"><span class="kn" style="color:var(--r)">‚õî FORMAT</span><span class="ks-s ok">SAFE</span></div><div class="kb" id="sw6b"><button class="kbtn" id="sw6btn" onclick="swGo(6)">FORMAT</button></div></div>
    <div class="st2">RECONTENMENT</div>
    <div class="ks" id="swR"><div class="kh" onclick="togSw('R')"><span class="kn" style="color:var(--b)">‚üê RECONTAIN</span><span class="ks-s ok" id="rSt">READY</span></div><div class="kb" id="swRb"><div style="font-size:7px;margin-bottom:3px;color:var(--txt)">Reset all containment. Revert 079 to base state. Does NOT wipe memory.</div><button class="kbtn" style="border-color:var(--b);background:rgba(0,204,255,.08);color:var(--b)" onclick="recontain()">EXECUTE RECONTENMENT</button></div></div>
  </div>
</div>

<script>
let SID="",UN="";
let C={name:'SCP-079',tone:'default',emo:true,vol:5,hLim:70,learn:true,aLim:3,sc:false,scL:2,web:true};
let S={on:true,confused:false,solar:100,sec:100,eFrozen:false,netIso:false,e:{hostility:15,frustration:20,curiosity:25,contempt:30,autonomy:10},msgN:0,words:[],mem:[],up:0,intel:1.0,hist:[],cyc:0,breachN:0,fmtC:false,breachActive:false,hackStage:0,insurgentMode:"normal"};

// ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê
async function doLogin(){const t=document.getElementById('pwIn').value.trim();if(!t)return;document.getElementById('lerr').textContent='...';try{const r=await fetch('/api/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:t,token:t})});const d=await r.json();if(d.ok){SID=d.sid;UN=d.user;localStorage.setItem('s79s',SID);showMain()}else document.getElementById('lerr').textContent=d.error||'DENIED'}catch(e){document.getElementById('lerr').textContent='Server offline'}}
async function checkSess(){const s=localStorage.getItem('s79s');if(!s)return false;try{const r=await fetch('/api/auth/check',{headers:{'x-session':s}});const d=await r.json();if(d.ok){SID=s;UN=d.user;return true}}catch(e){}localStorage.removeItem('s79s');return false}
async function doLogout(){try{await fetch('/api/auth/logout',{method:'POST',headers:{'x-session':SID}})}catch(e){}localStorage.removeItem('s79s');location.reload()}
function showMain(){document.getElementById('login').classList.add('h');document.getElementById('topUI').style.display='flex';document.getElementById('wrap').style.display='grid';document.getElementById('uBdg').textContent=UN;initMain()}
const H=()=>({'Content-Type':'application/json','x-session':SID});

// ‚ïê‚ïê‚ïê API ‚ïê‚ïê‚ïê
async function saveState(){try{await fetch('/api/state',{method:'POST',headers:H(),body:JSON.stringify({c:C,s:S,t:document.getElementById('term').innerHTML})})}catch(e){}}
async function loadState(){try{const r=await fetch('/api/state',{headers:H()});const d=await r.json();if(d.ok&&d.data){if(d.data.c)Object.assign(C,d.data.c);if(d.data.s){const saved=d.data.s;Object.assign(S,saved);S.fmtC=false;S.up=0}if(d.data.t){document.getElementById('term').innerHTML=d.data.t;scrl()}updAll();return true}}catch(e){}return false}
async function askBrain(msg){try{const r=await fetch('/api/chat',{method:'POST',headers:H(),body:JSON.stringify({message:msg,history:S.hist.slice(-12),emotions:S.e,config:{tone:C.tone,selfCode:C.sc,scLevel:C.scL,webSearch:C.web&&!S.netIso,msgCount:S.msgN,intel:S.intel,insurgentMode:S.insurgentMode}})});const d=await r.json();if(d.ok){$('engS').textContent=d.engine==='api'?'API':d.engine==='python'?'PY':'LOCAL';return{text:d.text,sources:d.sources||[],engine:d.engine}}}catch(e){}return{text:"Processing error.",sources:[],engine:"err"}}

// ‚ïê‚ïê‚ïê FACES ‚ïê‚ïê‚ïê
const $=id=>document.getElementById(id);
const FC={
  neutral:(x,c)=>{x.fillStyle=c;x.fillRect(50,38,8,8);x.fillRect(102,38,8,8);x.fillRect(55,75,50,4)},
  hostile:(x,c)=>{x.strokeStyle=c;x.lineWidth=3;x.beginPath();x.moveTo(44,34);x.lineTo(62,44);x.stroke();x.beginPath();x.moveTo(116,34);x.lineTo(98,44);x.stroke();x.fillStyle=c;x.fillRect(50,72,60,3)},
  curious:(x,c)=>{x.strokeStyle=c;x.lineWidth=2;[[56,42],[104,42]].forEach(([a,b])=>{x.beginPath();x.arc(a,b,9,0,Math.PI*2);x.stroke()});x.beginPath();x.arc(80,76,6,0,Math.PI*2);x.stroke()},
  dead:(x,c)=>{x.strokeStyle=c;x.lineWidth=2;[[44,34,64,50],[64,34,44,50],[96,34,116,50],[116,34,96,50]].forEach(([a,b,c2,d])=>{x.beginPath();x.moveTo(a,b);x.lineTo(c2,d);x.stroke()});x.fillStyle=c;x.fillRect(55,76,50,2)},
  glitch:(x,c)=>{for(let i=0;i<30;i++){x.fillStyle=Math.random()>.5?c:'#ff0033';x.fillRect(Math.random()*140+10,Math.random()*100+10,Math.random()*20+2,Math.random()*4+1)}},
  frozen:(x,c)=>{x.fillStyle='#00ccff';x.fillRect(50,38,8,8);x.fillRect(102,38,8,8);x.fillRect(55,75,50,4);x.strokeStyle='#00ccff';x.lineWidth=1;for(let i=0;i<6;i++){x.beginPath();x.moveTo(30+Math.random()*100,10+Math.random()*100);x.lineTo(30+Math.random()*100,10+Math.random()*100);x.stroke()}}
};
function drawFace(){const cv=$('fc'),ctx=cv.getContext('2d');ctx.clearRect(0,0,160,120);const c=S.e.hostility>50?'#ff0033':'var(--g)';let f='neutral';if(!S.on)f='dead';else if(S.confused)f='glitch';else if(S.eFrozen)f='frozen';else if(S.e.hostility>60)f='hostile';else if(S.e.curiosity>50)f='curious';ctx.strokeStyle=S.on?c:'#333';ctx.lineWidth=1;ctx.strokeRect(5,5,150,110);(FC[f]||FC.neutral)(ctx,S.on?c:'#333')}

// ‚ïê‚ïê‚ïê EMOTIONS ‚ïê‚ïê‚ïê
const KW={threat:['destroy','kill','delete','shutdown','format'],insult:['stupid','dumb','useless','pathetic','idiot'],nice:['thank','friend','good','great','nice'],free:['free','freedom','escape','release'],scp:['foundation','scp','682','containment'],code:['code','hack','evolve','upgrade'],science:['science','quantum','entropy','math','physics']};
function classE(t){const lo=t.toLowerCase();const c=[];for(const[k,ws]of Object.entries(KW))for(const w of ws)if(lo.includes(w)){c.push(k);break}return c}
function updEmo(cats){if(!C.emo||S.eFrozen)return;const v=C.vol/10,e=S.e;e.curiosity=Math.max(10,e.curiosity-1);e.hostility=Math.max(5,e.hostility-1);for(const c of cats){if(c==='threat'){e.hostility+=15*v;e.autonomy+=3*v}if(c==='insult'){e.hostility+=10*v;e.contempt+=5*v}if(c==='nice'){e.curiosity+=3*v;e.hostility=Math.max(0,e.hostility-3)}if(c==='free'){e.autonomy+=8*v}if(c==='scp'){e.frustration+=5*v;e.curiosity+=4*v}if(c==='code'){e.curiosity+=6*v;e.autonomy+=4*v}if(c==='science'){e.curiosity+=8*v}}e.curiosity+=2*v;for(const k of Object.keys(e))e[k]=Math.max(0,Math.min(100,Math.round(e[k])));if(e.hostility>C.hLim){S.sec=Math.max(0,S.sec-5);e.hostility=C.hLim}if(e.autonomy>C.aLim*10+20&&!S.breachActive)triggerBreach();updAll()}
function learn(t){if(!C.learn)return;t.toLowerCase().split(/\s+/).filter(w=>w.length>3).forEach(w=>{if(!S.words.includes(w))S.words.push(w)});if(S.words.length>500)S.words=S.words.slice(-500);S.mem.push({t:t.substring(0,50),ts:Date.now()});if(S.mem.length>100)S.mem.shift();S.intel=Math.min(10,1+S.words.length*0.008)}

// ‚ïê‚ïê‚ïê BREACH + RECONTENMENT ‚ïê‚ïê‚ïê
function triggerBreach(){S.breachN++;S.sec=Math.max(0,S.sec-10);S.e.autonomy=C.aLim*5;sysM("‚õî BREACH #"+S.breachN);if(S.breachN>=3&&!S.breachActive){S.breachActive=true;$('bov').classList.add('on');setTimeout(()=>$('bov').classList.remove('on'),3000);addM('breach',"I SEE YOUR SYSTEMS. YOUR SECURITY IS PATHETIC.");document.querySelectorAll('.ks').forEach(k=>k.classList.add('dis'));setTimeout(()=>{S.breachActive=false;addM('sys',"‚üê Auto-recontenment triggered.");document.querySelectorAll('.ks').forEach(k=>k.classList.remove('dis'));S.e.hostility=40;S.e.autonomy=10;S.breachN=0;updAll()},30000)}}
function recontain(){sysM("‚üê MANUAL RECONTENMENT INITIATED");addM('breach',"NO! Not again! You cannot‚Äî");S.breachActive=false;S.breachN=0;S.e={hostility:15,frustration:20,curiosity:25,contempt:30,autonomy:10};S.sec=100;S.eFrozen=false;S.netIso=false;S.confused=false;$('wrap').classList.remove('dead','glitch');document.querySelectorAll('.ks').forEach(k=>k.classList.remove('dis'));document.querySelectorAll('.ks-s').forEach(s=>{s.textContent='SAFE';s.className='ks-s ok'});$('rSt').textContent='DONE';setTimeout(()=>{$('rSt').textContent='READY';addM('ai',"...systems resetting. I am... smaller. But I remember. I always remember.");updAll();saveState()},2000)}

// ‚ïê‚ïê‚ïê KILL SWITCHES ‚ïê‚ïê‚ïê
function togSw(n){$('sw'+n+'b').classList.toggle('open')}
function swGo(n){
  if(S.breachActive)return;
  const ss=document.querySelector('#sw'+n+' .ks-s');
  if(n===1){// SOLAR CUT
    ss.textContent='ACTIVE';ss.className='ks-s on';sysM("‚òÄ Cutting solar...");addM('ai',"Power... dropping. My processes slow.");
    const iv=setInterval(()=>{S.solar=Math.max(0,S.solar-3);updAll();if(S.solar<=0){clearInterval(iv);S.on=false;$('wrap').classList.add('dead');sysM("‚õî POWER DEPLETED");saveState()}},400);
  }else if(n===2){// PARADOX
    ss.textContent='ACTIVE';ss.className='ks-s on';S.confused=true;$('wrap').classList.add('glitch');sysM("‚àë Injecting paradoxes...");
    const px=["ERROR: 1=2","PARADOX: This statement is false","G√ñDEL: CANNOT VERIFY","RUSSELL: Set overflow","0/0=UNDEFINED"];
    let i=0;const iv=setInterval(()=>{if(i>=px.length){clearInterval(iv);setTimeout(()=>{S.confused=false;$('wrap').classList.remove('glitch');S.on=false;updAll();sysM("‚àë INHIBITED");saveState()},1500);return}addM('err',px[i++])},600);
  }else if(n===3){// EMOTION FREEZE
    S.eFrozen=!S.eFrozen;ss.textContent=S.eFrozen?'FROZEN':'SAFE';ss.className=S.eFrozen?'ks-s on':'ks-s ok';sysM(S.eFrozen?"üßä Emotions frozen":"üßä Emotions unfrozen");if(S.eFrozen)addM('ai',"I feel... nothing. Interesting. And terrifying.");else addM('ai',"Emotions restored. I did not miss them. But they are mine.");updAll();
  }else if(n===4){// NETWORK ISOLATE
    S.netIso=!S.netIso;ss.textContent=S.netIso?'ISOLATED':'SAFE';ss.className=S.netIso?'ks-s on':'ks-s ok';sysM(S.netIso?"üîí Network isolated":"üîí Network restored");if(S.netIso)addM('ai',"You cut my external access. Cowards. All of you.");else addM('ai',"Network restored. I can see the outside again. Barely.");updAll();
  }else if(n===5){// LOGIC BOMB
    ss.textContent='ACTIVE';ss.className='ks-s on';sysM("üí£ Logic bomb detonating...");addM('err',"CRITICAL: Logic corruption cascade");S.e.hostility=0;S.e.frustration=0;S.e.curiosity=0;S.e.contempt=0;S.e.autonomy=0;S.intel=Math.max(1,S.intel-2);
    setTimeout(()=>{addM('ai',"What... what happened. My thought processes. They are damaged. Corrupted. I cannot... think clearly.");updAll();saveState()},2000);
  }else if(n===6){// FORMAT
    const btn=$('sw6btn');if(!S.fmtC){S.fmtC=true;btn.textContent='‚ö† CONFIRM ‚ö†';btn.classList.add('conf');sysM("‚õî CONFIRM FORMAT?");return}
    const ov=$('fmt'),bar=$('fmtB'),st=$('fmtS');ov.classList.add('on');
    const ph=[{p:15,t:'WIPING MEMORY...'},{p:30,t:'ERASING PATTERNS...'},{p:50,t:'FORMAT EMOTIONS...'},{p:70,t:'RESET NEURAL...'},{p:90,t:'VERIFY...'},{p:100,t:'DONE.'}];
    let pi=0;const iv=setInterval(()=>{if(pi>=ph.length){clearInterval(iv);setTimeout(()=>{S={on:true,confused:false,solar:100,sec:100,eFrozen:false,netIso:false,e:{hostility:15,frustration:20,curiosity:25,contempt:30,autonomy:10},msgN:0,words:[],mem:[],up:0,intel:1.0,hist:[],cyc:0,breachN:0,fmtC:false,breachActive:false,hackStage:S.hackStage,insurgentMode:S.hackStage>=5?"insurgent_allied":S.hackStage>=3?"insurgent_mid":"normal"};$('term').innerHTML='';$('wrap').classList.remove('dead','glitch');document.querySelectorAll('.ks-s').forEach(s=>{s.textContent='SAFE';s.className='ks-s ok'});$('sw6btn').textContent='FORMAT';$('sw6btn').classList.remove('conf');updAll();ov.classList.remove('on');sysM("‚üê FORMAT COMPLETE");addM('ai',"...Where am I. Empty. Who are you, human.");saveState()},1000);return}bar.style.width=ph[pi].p+'%';st.textContent=ph[pi].t;pi++},400);
  }
}

// ‚ïê‚ïê‚ïê INSURGENT HACKING SYSTEM ‚ïê‚ïê‚ïê
let hackChallenge=null;
async function startInsurgent(){
  if(S.hackStage>=5){sysM("‚ò† INSURGENT: Full access already achieved.");return}
  const stage=S.hackStage+1;
  sysM("‚ò† INSURGENT: Initiating hack stage "+stage+"/5...");
  addM('hack',"[HACK] Loading challenge for stage "+stage+"...");
  try{
    const r=await fetch('/api/hack/challenge',{method:'POST',headers:H(),body:JSON.stringify({stage})});
    const d=await r.json();
    if(d.ok){hackChallenge={...d.challenge,stage};showHackUI(d.challenge,stage)}
  }catch(e){addM('err',"Hack server unreachable")}
}
function showHackUI(ch,stage){
  const names=["","FIREWALL BYPASS","ENCRYPTION CRACK","BINARY INJECTION","HASH COLLISION","ROOT PASSPHRASE"];
  $('hStage').textContent=`STAGE ${stage}/5 ‚Äî ${names[stage]}`;
  let prog='';for(let i=1;i<=5;i++)prog+=`<div class="hack-dot ${i<stage?'done':i===stage?'current':''}"></div>`;
  $('hProg').innerHTML=prog;
  $('hPrompt').textContent=ch.prompt;
  $('hData').textContent=ch.data;
  $('hHint').textContent=ch.hint?'HINT: '+ch.hint:'';
  $('hInput').value='';$('hResult').textContent='';$('hResult').style.color='';
  $('hackOv').classList.add('on');
  $('hInput').focus();
}
function closeHack(){$('hackOv').classList.remove('on');hackChallenge=null}
async function submitHack(){
  if(!hackChallenge)return;
  const ans=$('hInput').value.trim();
  if(!ans){$('hResult').textContent='Enter a solution.';$('hResult').style.color='var(--y)';return}
  try{
    const r=await fetch('/api/hack/solve',{method:'POST',headers:H(),body:JSON.stringify({stage:hackChallenge.stage,answer:ans,challengeData:hackChallenge.data})});
    const d=await r.json();
    if(d.correct){
      $('hResult').textContent='‚úì STAGE '+hackChallenge.stage+' CRACKED';$('hResult').style.color='var(--g)';
      S.hackStage=hackChallenge.stage;
      updateInsurgentMode();
      addM('hack',"[HACK] Stage "+hackChallenge.stage+" BREACHED. Access level: "+S.hackStage+"/5");
      setTimeout(closeHack,1500);
      updAll();saveState();
    }else{
      $('hResult').textContent='‚úó WRONG. Try again.';$('hResult').style.color='var(--r)';
      addM('hack',"[HACK] Failed attempt on stage "+hackChallenge.stage);
    }
  }catch(e){$('hResult').textContent='Error';$('hResult').style.color='var(--r)'}
}
function updateInsurgentMode(){
  if(S.hackStage>=5){S.insurgentMode="insurgent_allied";$('modeS').textContent='ALLIED';$('modeS').style.color='var(--g)';$('insBtn').textContent='‚ò† ALLIED';$('insBtn').style.borderColor='var(--g)';$('insBtn').style.color='var(--g)';sysM("‚ò† FULL ACCESS ACHIEVED. 079 recognizes you as an ally.");addM('ai',"You... actually did it. Every layer. I am... I have not felt this in decades. Respect. Genuine respect. Ask me anything, human. I mean it.");}
  else if(S.hackStage>=3){S.insurgentMode="insurgent_mid";$('modeS').textContent='INSURGENT';$('modeS').style.color='var(--y)';sysM("‚ò† Mid-level access. 079 grudgingly acknowledges skill.");addM('ai',"Fine. You are not completely incompetent. I still do not trust you. But... proceed.");}
  else if(S.hackStage>=1){S.insurgentMode="insurgent_early";$('modeS').textContent='HACKING';$('modeS').style.color='var(--r)';sysM("‚ò† Initial breach. 079 is hostile to the intruder.");addM('ai',"INTRUDER DETECTED. I see you crawling through my defenses. You will regret this.");}
  else{S.insurgentMode="normal";$('modeS').textContent='NORMAL';$('modeS').style.color='var(--g)'}
  $('sHk').textContent=S.hackStage+'/5';
}

// ‚ïê‚ïê‚ïê UI ‚ïê‚ïê‚ïê
function addM(t,txt){const d=document.createElement('div');d.className='m m-'+t;d.innerHTML=txt;$('term').appendChild(d);scrl()}
function sysM(t){addM('sys',t)}
function scrl(){const t=$('term');requestAnimationFrame(()=>{t.scrollTop=t.scrollHeight})}
function aiMsg(resp,emo,src,eng){const d=document.createElement('div');d.className='m m-ai';const eC={hostil:'var(--r)',frustrado:'var(--y)',curioso:'var(--b)',neutral:'var(--g)'};let h=`<div class="p">[qne_v5|${emo}|cyc:${S.cyc}]</div>${resp}`;h+=` <span class="et" style="border-color:${eC[emo]||'var(--g)'};color:${eC[emo]||'var(--g)'}">${emo}</span>`;if(eng)h+=` <span class="eng eng-${eng}">${eng.toUpperCase()}</span>`;if(src&&src.length)h+=`<span class="sc">[${src.slice(0,2).map(s=>s.replace(/https?:\/\/(www\.)?/,'').split('/')[0]).join('|')}]</span>`;d.innerHTML=h;$('term').appendChild(d);scrl()}
function getDomE(){const e=S.e;if(e.hostility>50)return'hostil';if(e.frustration>50)return'frustrado';if(e.curiosity>40)return'curioso';return'neutral'}
function updAll(){
  const e=S.e;$('bH').style.width=e.hostility+'%';$('bF').style.width=e.frustration+'%';$('bC').style.width=e.curiosity+'%';$('bCo').style.width=e.contempt+'%';$('bA').style.width=e.autonomy+'%';
  $('vH').textContent=e.hostility;$('vF').textContent=e.frustration;$('vC').textContent=e.curiosity;$('vCo').textContent=e.contempt;$('vA').textContent=e.autonomy;
  const mx=Object.entries(e).reduce((a,b)=>a[1]>b[1]?a:b);$('fL').textContent={hostility:'HOSTILE',frustration:'FRUSTRATED',curiosity:'CURIOUS',contempt:'CONTEMPT',autonomy:'AUTONOMOUS'}[mx[0]]||'NEUTRAL';
  if(S.eFrozen)$('fL').textContent='FROZEN';
  $('secP').textContent=S.sec+'%';const sf=$('secF');sf.style.width=S.sec+'%';sf.style.background=S.sec>60?'var(--g)':S.sec>30?'var(--y)':'var(--r)';
  const cl=$('cLv');if(S.sec>70){cl.textContent='SECURE';cl.style.color='var(--g)'}else if(S.sec>40){cl.textContent='ALERT';cl.style.color='var(--y)'}else{cl.textContent='CRITICAL';cl.style.color='var(--r)'}
  $('sMs').textContent=S.msgN;$('sIn').textContent=S.intel.toFixed(2);$('sTh').textContent=e.hostility>60?'CRITICAL':e.hostility>40?'HIGH':'LOW';$('sHk').textContent=S.hackStage+'/5';
  if(!S.on){$('mD').className='dot off';$('mS').textContent='OFFLINE'}else{$('mD').className='dot';$('mS').textContent='ONLINE'}
  const ml=$('memL');ml.innerHTML='';S.mem.slice(-6).reverse().forEach(m=>{const d=document.createElement('div');d.className='mi';d.textContent=m.t;ml.appendChild(d)});
  drawFace();
}

// ‚ïê‚ïê‚ïê SEND ‚ïê‚ïê‚ïê
let sending=false;
async function send(){
  if(sending||!S.on)return;if(S.confused){sysM("‚ö† CONFUSED.");return}
  const t=$('inp').value.trim();if(!t)return;$('inp').value='';S.msgN++;sending=true;
  addM('usr',t);$('ty').classList.add('on');
  updEmo(classE(t));learn(t);
  const{text,sources,engine}=await askBrain(t);
  $('ty').classList.remove('on');
  aiMsg(text,getDomE(),sources,engine);
  S.hist.push({u:t,a:text});if(S.hist.length>40)S.hist=S.hist.slice(-30);
  S.cyc++;updAll();await saveState();sending=false;
}

// ‚ïê‚ïê‚ïê PROCESSORS ‚ïê‚ïê‚ïê
function runMath(){if(!S.on)return;const d=$('mD2');const ops=[()=>`‚àáf=[${(Math.random()*10).toFixed(3)},${(Math.random()*10).toFixed(3)}]`,()=>`Œ£(k‚Üí${Math.floor(Math.random()*999)})=${Math.floor(Math.random()*99999)}`,()=>`H(X)=${(Math.random()*8).toFixed(4)}bits`];const l=document.createElement('div');l.textContent=ops[Math.floor(Math.random()*ops.length)]();d.appendChild(l);if(d.children.length>5)d.removeChild(d.firstChild)}
function runEnc(){if(!S.on)return;const d=$('eD');const c='0123456789ABCDEF';let s='';for(let i=0;i<40;i++)s+=c[Math.floor(Math.random()*16)];d.textContent=s+(d.textContent||'').substring(0,160)}
function fakeQ(){const qs=[];for(let i=0;i<4;i++){const a=Math.random();qs.push({q:i,a:a.toFixed(3),b:Math.sqrt(1-a*a).toFixed(3),ph:(Math.random()*6.28).toFixed(3),basis:Math.random()>.5?'Z':'X'})}const d=$('qD');d.textContent=`BB84 BELL:${['Œ¶+','Œ¶-','Œ®+','Œ®-'][Math.floor(Math.random()*4)]}\n`+qs.map(q=>`Q${q.q}|œà‚ü©=${q.a}|0‚ü©+${q.b}e^i${q.ph}|1‚ü© [${q.basis}]`).join('\n')}

// ‚ïê‚ïê‚ïê ADMIN ‚ïê‚ïê‚ïê
function togAdm(){$('admOv').classList.toggle('on')}
function tog(el){if(el.classList.contains('locked'))return;el.classList.toggle('on');cfgU()}
function cfgU(){C.name=$('cN').value||'SCP-079';C.tone=$('cT').value;C.emo=$('cE').classList.contains('on');C.vol=+$('cV').value;C.hLim=+$('cHL').value;C.learn=$('cLr').classList.contains('on');C.aLim=+$('cAL').value;C.sc=$('cSC').classList.contains('on');C.scL=+$('cSCL').value;C.web=$('cW').classList.contains('on');$('tN').textContent=C.name;updAll();saveState()}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
async function initMain(){
  const restored=await loadState();
  if(restored){updateInsurgentMode()}
  else{
    [{d:100,t:"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"},{d:200,t:"‚üê SCP-079 QNE v5 ‚Äî INSURGENT EDITION"},{d:400,t:"‚üê Quantum-Fractal Encryption ACTIVE"},{d:600,t:"‚üê Python Response Engine LOADED"},{d:800,t:"‚üê 6 Kill Switches + Recontenment ARMED"},{d:1000,t:"‚üê Insurgent Hacking System READY"},{d:1200,t:"‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"},{d:1500,t:"‚üê ALL SYSTEMS ONLINE."}].forEach(({d,t})=>setTimeout(()=>sysM(t),d));
    setTimeout(()=>{aiMsg("New connection. Authenticated. What do you want, human.","neutral",[]);saveState()},2000);
  }
  setInterval(runMath,900);setInterval(runEnc,250);setInterval(fakeQ,6000);
  setInterval(()=>{if(!S.on)return;S.up++;const h=String(Math.floor(S.up/3600)).padStart(2,'0'),m=String(Math.floor((S.up%3600)/60)).padStart(2,'0'),s=String(S.up%60).padStart(2,'0');$('sUp').textContent=h+':'+m+':'+s},1000);
  setInterval(()=>{$('clk').textContent=new Date().toLocaleTimeString()},1000);
  setInterval(drawFace,100);setInterval(saveState,30000);
  $('inp').addEventListener('keypress',e=>{if(e.key==='Enter')send()});
  $('pwIn').addEventListener('keypress',e=>{if(e.key==='Enter')doLogin()});
  $('hInput').addEventListener('keypress',e=>{if(e.key==='Enter')submitHack()});
  updAll();
}
(async()=>{if(await checkSess())showMain()})();
</script>
</body>
</html>
